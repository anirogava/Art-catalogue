"use strict";(self.webpackChunkmuseum=self.webpackChunkmuseum||[]).push([[951],{7951:(sv,Qa,D)=>{D.r(Qa),D.d(Qa,{ContentModule:()=>rv});var Pe=D(6019),Bt=D(8779),pe=D(9133),Ha=D(273),qs=D(9947),Us=D(8889),_d=D(9985),Td=D(6921);const Ed=[1,2,3,4,5],Wa="RESET_FORM";var Ya=D(3067),ye=D(4753),Vs=D(423),c=D(3668),Bs=D(8260),xd=D(4522);let xr=(()=>{class n{constructor(t){this.http=t}getArt(t){return this.http.get(`${Bs.N.museumApi}=${t}`)}getList(t){return this.http.get(`${Bs.N.base_url}objects/${t}`)}getArtByObjectId(t){return this.http.get(`${Bs.N.base_url}objects/${t}`)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(xd.eN))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var js=D(3339);let Sd=(()=>{class n{get(t){const r=localStorage.getItem(t);if(r)return JSON.parse(r)}set(t,r){localStorage.setItem(t,JSON.stringify(r))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ja=(()=>{class n{constructor(t){this.storage=t,this.lastThreeSearches=[]}addToLastSearches(t){if(this.lastThreeSearches.length<3)return this.lastThreeSearches=[t,...this.lastThreeSearches],void this.storage.set("lastThreeSearches",this.lastThreeSearches);this.lastThreeSearches=[t,...this.lastThreeSearches.slice(0,2)],this.storage.set("lastThreeSearches",this.lastThreeSearches)}restoreState(){const t=this.storage.get("lastThreeSearches");t&&t.length>0&&(this.lastThreeSearches=t)}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Sd))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var bn=D(5947),Ad=D(2210),bd=D(8410),Xa=D(2997),ke=D(7233),Zs=D(3970);function Ks(){return(0,qs.e)((n,e)=>{let t,r=!1;n.subscribe(new Us.Q(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var $s=D(9495),Cd=D(4623);function Nd(n,e){return n===e}var I,Gs=D(461),Sr=D(7905),kd=(D(9777),D(6293)),g=D(8239),Ar=D(1572),eu=D(1177),yt=D(3855),O=D(4213),Rd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$e={},zs=zs||{},b=Rd||self;function br(){}function Qs(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Cn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Hs="closure_uid_"+(1e9*Math.random()>>>0),Od=0;function Fd(n,e,t){return n.call.apply(n.bind,arguments)}function Md(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function se(n,e,t){return(se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fd:Md).apply(null,arguments)}function Cr(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ie(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function tt(){this.s=this.s,this.o=this.o}var qd={};tt.prototype.s=!1,tt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function(n){return Object.prototype.hasOwnProperty.call(n,Hs)&&n[Hs]||(n[Hs]=++Od)}(this);delete qd[n]}},tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const tu=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},nu=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function ru(n){return Array.prototype.concat.apply([],arguments)}function Ws(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Dr(n){return/^[\s\xa0]*$/.test(n)}var we,su=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ve(n,e){return-1!=n.indexOf(e)}function Ys(n,e){return n<e?-1:n>e?1:0}e:{var iu=b.navigator;if(iu){var ou=iu.userAgent;if(ou){we=ou;break e}}we=""}function Js(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function au(n){const e={};for(const t in n)e[t]=n[t];return e}var uu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function cu(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<uu.length;i++)t=uu[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Xs(n){return Xs[" "](n),n}Xs[" "]=br;var Nr,n,Bd=ve(we,"Opera"),jt=ve(we,"Trident")||ve(we,"MSIE"),hu=ve(we,"Edge"),ei=hu||jt,lu=ve(we,"Gecko")&&!(ve(we.toLowerCase(),"webkit")&&!ve(we,"Edge"))&&!(ve(we,"Trident")||ve(we,"MSIE"))&&!ve(we,"Edge"),jd=ve(we.toLowerCase(),"webkit")&&!ve(we,"Edge");function du(){var n=b.document;return n?n.documentMode:void 0}e:{var ti="",ni=(n=we,lu?/rv:([^\);]+)(\)|;)/.exec(n):hu?/Edge\/([\d\.]+)/.exec(n):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):jd?/WebKit\/(\S+)/.exec(n):Bd?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ni&&(ti=ni?ni[1]:""),jt){var ri=du();if(null!=ri&&ri>parseFloat(ti)){Nr=String(ri);break e}}Nr=ti}var Zd={};function Kd(){return e=Zd,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let n=0;const e=su(String(Nr)).split("."),t=su("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=Ys(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||Ys(0==s[2].length,0==i[2].length)||Ys(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n}();var e}var $d=b.document&&jt&&(du()||parseInt(Nr,10))||void 0,Gd=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{b.addEventListener("test",br,e),b.removeEventListener("test",br,e)}catch(t){}return n}();function le(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Dn(n,e){if(le.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(lu){e:{try{Xs(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:zd[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Dn.Z.h.call(this)}}le.prototype.h=function(){this.defaultPrevented=!0},ie(Dn,le);var zd={2:"touch",3:"pen",4:"mouse"};Dn.prototype.h=function(){Dn.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Nn="closure_listenable_"+(1e6*Math.random()|0),Qd=0;function Hd(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++Qd,this.ca=this.fa=!1}function kr(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function Rr(n){this.src=n,this.g={},this.h=0}function ii(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=tu(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(kr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function oi(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}Rr.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=oi(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new Hd(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var ai="closure_lm_"+(1e6*Math.random()|0),ui={};function mu(n,e,t,r,s){if(r&&r.once)return pu(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)mu(n,e[i],t,r,s);return null}return t=di(t),n&&n[Nn]?n.N(e,t,Cn(r)?!!r.capture:!!r,s):gu(n,e,t,!1,r,s)}function gu(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Cn(s)?!!s.capture:!!s,a=hi(n);if(a||(n[ai]=a=new Rr(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function(){var e=Yd;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Gd||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(vu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function pu(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)pu(n,e[i],t,r,s);return null}return t=di(t),n&&n[Nn]?n.O(e,t,Cn(r)?!!r.capture:!!r,s):gu(n,e,t,!0,r,s)}function yu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)yu(n,e[i],t,r,s);else r=Cn(r)?!!r.capture:!!r,t=di(t),n&&n[Nn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=oi(i=n.g[e],t,r,s))&&(kr(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=hi(n))&&(e=n.g[e.toString()],n=-1,e&&(n=oi(e,t,r,s)),(t=-1<n?e[n]:null)&&ci(t))}function ci(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[Nn])ii(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(vu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=hi(e))?(ii(t,n),0==t.h&&(t.src=null,e[ai]=null)):kr(n)}}}function vu(n){return n in ui?ui[n]:ui[n]="on"+n}function Yd(n,e){if(n.ca)n=!0;else{e=new Dn(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&ci(n),n=t.call(r,e)}return n}function hi(n){return(n=n[ai])instanceof Rr?n:null}var li="__closure_events_fn_"+(1e9*Math.random()>>>0);function di(n){return"function"==typeof n?n:(n[li]||(n[li]=function(e){return n.handleEvent(e)}),n[li])}function J(){tt.call(this),this.i=new Rr(this),this.P=this,this.I=null}function oe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new le(e,n);else if(e instanceof le)e.target=e.target||n;else{var s=e;cu(e=new le(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Lr(o,r,!0,e)&&s}if(s=Lr(o=e.g=n,r,!0,e)&&s,s=Lr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Lr(o=e.g=t[i],r,!1,e)&&s}function Lr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,u=o.ia||o.src;o.fa&&ii(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}ie(J,tt),J.prototype[Nn]=!0,J.prototype.removeEventListener=function(n,e,t,r){yu(this,n,e,t,r)},J.prototype.M=function(){if(J.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)kr(t[r]);delete n.g[e],n.h--}}this.I=null},J.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},J.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var fi=b.JSON.stringify;function Jd(){var n=_u;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var gi,wu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new ef,n=>n.reset());class ef{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function tf(n){b.setTimeout(()=>{throw n},0)}function mi(n,e){gi||function(){var n=b.Promise.resolve(void 0);gi=function(){n.then(rf)}}(),pi||(gi(),pi=!0),_u.add(n,e)}var pi=!1,_u=new class{constructor(){this.h=this.g=null}add(e,t){const r=wu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function rf(){for(var n;n=Jd();){try{n.h.call(n.g)}catch(t){tf(t)}var e=wu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}pi=!1}function Or(n,e){J.call(this),this.h=n||1,this.g=e||b,this.j=se(this.kb,this),this.l=Date.now()}function yi(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function vi(n,e,t){if("function"==typeof n)t&&(n=se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=se(n.handleEvent,n)}return 2147483647<Number(e)?-1:b.setTimeout(n,e||0)}function Tu(n){n.g=vi(()=>{n.g=null,n.i&&(n.i=!1,Tu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ie(Or,J),(I=Or.prototype).da=!1,I.S=null,I.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),oe(this,"tick"),this.da&&(yi(this),this.start()))}},I.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},I.M=function(){Or.Z.M.call(this),yi(this),delete this.g};class sf extends tt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Tu(this)}M(){super.M(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kn(n){tt.call(this),this.h=n,this.g={}}ie(kn,tt);var Iu=[];function Eu(n,e,t,r){Array.isArray(t)||(t&&(Iu[0]=t.toString()),t=Iu);for(var s=0;s<t.length;s++){var i=mu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function xu(n){Js(n.g,function(e,t){this.g.hasOwnProperty(t)&&ci(e)},n),n.g={}}function Fr(){this.g=!0}function Zt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return fi(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}kn.prototype.M=function(){kn.Z.M.call(this),xu(this)},kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Fr.prototype.Aa=function(){this.g=!1},Fr.prototype.info=function(){};var vt={},Su=null;function Mr(){return Su=Su||new J}function Au(n){le.call(this,vt.Ma,n)}function Rn(n){const e=Mr();oe(e,new Au(e,n))}function bu(n,e){le.call(this,vt.STAT_EVENT,n),this.stat=e}function _e(n){const e=Mr();oe(e,new bu(e,n))}function Cu(n,e){le.call(this,vt.Na,n),this.size=e}function Ln(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){n()},e)}vt.Ma="serverreachability",ie(Au,le),vt.STAT_EVENT="statevent",ie(bu,le),vt.Na="timingevent",ie(Cu,le);var Pr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Du={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function wi(){}function ku(){}wi.prototype.h=null;var Ii,On={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function _i(){le.call(this,"d")}function Ti(){le.call(this,"c")}function qr(){}function Fn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new kn(this),this.P=hf,this.W=new Or(n=ei?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ru}function Ru(){this.i=null,this.g="",this.h=!1}ie(_i,le),ie(Ti,le),ie(qr,wi),qr.prototype.g=function(){return new XMLHttpRequest},qr.prototype.i=function(){return{}},Ii=new qr;var hf=45e3,Ei={},Ur={};function xi(n,e,t){n.K=1,n.v=Kr(Ge(e)),n.s=t,n.U=!0,Lu(n,null)}function Lu(n,e){n.F=Date.now(),Mn(n),n.A=Ge(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),ju(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Ru,n.g=lc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new sf(se(n.Ia,n,n.g),n.O)),Eu(n.V,n.g,"readystatechange",n.gb),e=n.H?au(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),Rn(1),function(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var h=a[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function Ou(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Fu(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=lf(n,t),s==Ur){4==e&&(n.o=4,_e(14),r=!1),Zt(n.j,n.m,null,"[Incomplete Response]");break}if(s==Ei){n.o=4,_e(15),Zt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Zt(n.j,n.m,s,null),Si(n,s)}Ou(n)&&s!=Ur&&s!=Ei&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,_e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Mi(e),e.L=!0,_e(11))):(Zt(n.j,n.m,t,"[Invalid Chunked Response]"),wt(n),Pn(n))}function lf(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ur:(t=Number(e.substring(t,r)),isNaN(t)?Ei:(r+=1)+t>e.length?Ur:(e=e.substr(r,t),n.C=r+t,e))}function Mn(n){n.Y=Date.now()+n.P,Mu(n,n.P)}function Mu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Ln(se(n.eb,n),e)}function Vr(n){n.B&&(b.clearTimeout(n.B),n.B=null)}function Pn(n){0==n.l.G||n.I||ac(n.l,n)}function wt(n){Vr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,yi(n.W),xu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Si(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ci(t.i,n)))if(t.I=n.N,!n.J&&Ci(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(h){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0])e:if(t.u)t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=Ln(se(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Wr(t),Qr(t)}Fi(t),_e(18)}if(1>=$u(t.i)&&t.ka){try{t.ka()}catch(h){}t.ka=void 0}}else It(t,11)}else if((n.J||t.g==n)&&Wr(t),!Dr(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const l=h[3];null!=l&&(t.ma=l,t.h.info("VER="+t.ma));const d=h[4];null!=d&&(t.za=d,t.h.info("SVER="+t.za));const m=h[5];null!=m&&"number"==typeof m&&0<m&&(t.K=r=1.5*m,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const w=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var i=r.i;!i.g&&(ve(w,"spdy")||ve(w,"quic")||ve(w,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Di(i,i.h),i.h=null))}if(r.D){const S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.sa=S,U(r.F,r.D,S))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=hc(r,r.H?r.la:null,r.W),o.J){Gu(r.i,o);var a=o,u=r.K;u&&a.setTimeout(u),a.B&&(Vr(a),Mn(a)),r.g=o}else ic(r);0<t.l.length&&Hr(t)}else"stop"!=h[0]&&"close"!=h[0]||It(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?It(t,7):Li(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}Rn(4)}catch(h){}}function Ai(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Qs(n)||"string"==typeof n)nu(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(Qs(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;r=function(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(Qs(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function Kt(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof Kt)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function bi(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];_t(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)_t(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function _t(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(I=Fn.prototype).setTimeout=function(n){this.P=n},I.gb=function(n){n=n.target;const e=this.L;e&&3==ze(n)?e.l():this.Ia(n)},I.Ia=function(n){try{if(n==this.g)e:{const l=ze(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>l)&&(3!=l||ei||this.g&&(this.h.h||this.g.ga()||ec(this.g)))){this.I||4!=l||7==e||Rn(8==e||0>=d?3:2),Vr(this);var t=this.g.ba();this.N=t;t:if(Ou(this)){var r=ec(this.g);n="";var s=r.length,i=4==ze(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){wt(this),Pn(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,l,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Dr(a)){var h=a;break t}}h=null}if(!(t=h)){this.i=!1,this.o=3,_e(12),wt(this),Pn(this);break e}Zt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Si(this,t)}this.U?(Fu(this,l,o),ei&&this.i&&3==l&&(Eu(this.V,this.W,"tick",this.fb),this.W.start())):(Zt(this.j,this.m,o,null),Si(this,o)),4==l&&wt(this),this.i&&!this.I&&(4==l?ac(this.l,this):(this.i=!1,Mn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,_e(12)):(this.o=0,_e(13)),wt(this),Pn(this)}}}catch(l){}},I.fb=function(){if(this.g){var n=ze(this.g),e=this.g.ga();this.C<e.length&&(Vr(this),Fu(this,n,e),this.i&&4!=n&&Mn(this))}},I.cancel=function(){this.I=!0,wt(this)},I.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Rn(3),_e(17)),wt(this),this.o=2,Pn(this)):Mu(this,this.Y-n)},(I=Kt.prototype).R=function(){bi(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},I.T=function(){return bi(this),this.g.concat()},I.get=function(n,e){return _t(this.h,n)?this.h[n]:e},I.set=function(n,e){_t(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},I.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Pu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Tt(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof Tt){this.g=void 0!==e?e:n.g,Br(this,n.j),this.s=n.s,jr(this,n.i),Zr(this,n.m),this.l=n.l,e=n.h;var t=new Vn;t.i=e.i,e.g&&(t.g=new Kt(e.g),t.h=e.h),qu(this,t),this.o=n.o}else n&&(t=String(n).match(Pu))?(this.g=!!e,Br(this,t[1]||"",!0),this.s=qn(t[2]||""),jr(this,t[3]||"",!0),Zr(this,t[4]),this.l=qn(t[5]||"",!0),qu(this,t[6]||"",!0),this.o=qn(t[7]||"")):(this.g=!!e,this.h=new Vn(null,this.g))}function Ge(n){return new Tt(n)}function Br(n,e,t){n.j=t?qn(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function jr(n,e,t){n.i=t?qn(e,!0):e}function Zr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function qu(n,e,t){e instanceof Vn?(n.h=e,function(n,e){e&&!n.j&&(nt(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(Vu(this,r),ju(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Un(e,wf)),n.h=new Vn(e,n.g))}function U(n,e,t){n.h.set(e,t)}function Kr(n){return U(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function qn(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Un(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,pf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function pf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Tt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Un(e,Uu,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Un(e,Uu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Un(t,"/"==t.charAt(0)?vf:yf,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Un(t,_f)),n.join("")};var Uu=/[#\/\?@]/g,yf=/[#\?:]/g,vf=/[#\?]/g,wf=/[#\?@]/g,_f=/#/g;function Vn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function nt(n){n.g||(n.g=new Kt,n.h=0,n.i&&function(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Vu(n,e){nt(n),e=$t(n,e),_t(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,_t((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&bi(n)))}function Bu(n,e){return nt(n),e=$t(n,e),_t(n.g.h,e)}function ju(n,e,t){Vu(n,e),0<t.length&&(n.i=null,n.g.set($t(n,e),Ws(t)),n.h+=t.length)}function $t(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Zu(n){this.l=n||Ef,n=b.PerformanceNavigationTiming?0<(n=b.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(b.g&&b.g.Ea&&b.g.Ea()&&b.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(I=Vn.prototype).add=function(n,e){nt(this),this.i=null,n=$t(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},I.forEach=function(n,e){nt(this),this.g.forEach(function(t,r){nu(t,function(s){n.call(e,s,r,this)},this)},this)},I.T=function(){nt(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},I.R=function(n){nt(this);var e=[];if("string"==typeof n)Bu(this,n)&&(e=ru(e,this.g.get($t(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=ru(e,n[t])}return e},I.set=function(n,e){return nt(this),this.i=null,Bu(this,n=$t(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},I.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},I.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var Ef=10;function Ku(n){return!!n.h||!!n.g&&n.g.size>=n.j}function $u(n){return n.h?1:n.g?n.g.size:0}function Ci(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Di(n,e){n.g?n.g.add(e):n.h=e}function Gu(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function zu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Ws(n.i)}function Ni(){}function xf(){this.g=new Ni}function Sf(n,e,t){const r=t||"";try{Ai(n,function(s,i){let o=s;Cn(s)&&(o=fi(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function $r(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Bn(n){this.l=n.$b||null,this.j=n.ib||!1}function Gr(n,e){J.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=ki,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zu.prototype.cancel=function(){if(this.i=zu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Ni.prototype.stringify=function(n){return b.JSON.stringify(n,void 0)},Ni.prototype.parse=function(n){return b.JSON.parse(n,void 0)},ie(Bn,wi),Bn.prototype.g=function(){return new Gr(this.l,this.j)},Bn.prototype.i=function(n){return function(){return n}}({}),ie(Gr,J);var ki=0;function Qu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function jn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Zn(n)}function Zn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(I=Gr.prototype).open=function(n,e){if(this.readyState!=ki)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Zn(this)},I.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||b).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jn(this)),this.readyState=ki},I.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Zn(this)),this.g&&(this.readyState=3,Zn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==b.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Qu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},I.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jn(this):Zn(this),3==this.readyState&&Qu(this)}},I.Ua=function(n){this.g&&(this.response=this.responseText=n,jn(this))},I.Ta=function(n){this.g&&(this.response=n,jn(this))},I.ha=function(){this.g&&jn(this)},I.setRequestHeader=function(n,e){this.v.append(n,e)},I.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},I.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Gr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var bf=b.JSON.parse;function K(n){J.call(this),this.headers=new Kt,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Hu,this.K=this.L=!1}ie(K,J);var Hu="",Cf=/^https?$/i,Df=["POST","PUT"];function kf(n){return"content-type"==n.toLowerCase()}function Wu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Yu(n),zr(n)}function Yu(n){n.D||(n.D=!0,oe(n,"complete"),oe(n,"error"))}function Ju(n){if(n.h&&void 0!==zs&&(!n.C[1]||4!=ze(n)||2!=n.ba()))if(n.v&&4==ze(n))vi(n.Fa,0,n);else if(oe(n,"readystatechange"),4==ze(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Pu)[1]||null;if(!s&&b.self&&b.self.location){var i=b.self.location.protocol;s=i.substr(0,i.length-1)}r=!Cf.test(s?s.toLowerCase():"")}t=r}if(t)oe(n,"complete"),oe(n,"success");else{n.m=6;try{var o=2<ze(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.ba()+"]",Yu(n)}}finally{zr(n)}}}function zr(n,e){if(n.g){Xu(n);const t=n.g,r=n.C[0]?br:null;n.g=null,n.C=null,e||oe(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function Xu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(b.clearTimeout(n.A),n.A=null)}function ze(n){return n.g?n.g.readyState:0}function ec(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Hu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ri(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function(n){let e="";return Js(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):U(n,e,t))}function Kn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function tc(n){this.za=0,this.l=[],this.h=new Fr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Kn("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Kn("baseRetryDelayMs",5e3,n),this.$a=Kn("retryDelaySeedMs",1e4,n),this.Ya=Kn("forwardChannelMaxRetries",2,n),this.ra=Kn("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Zu(n&&n.concurrentRequestLimit),this.Ca=new xf,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Li(n){if(nc(n),3==n.G){var e=n.V++,t=Ge(n.F);U(t,"SID",n.J),U(t,"RID",e),U(t,"TYPE","terminate"),$n(n,t),(e=new Fn(n,n.h,e,void 0)).K=2,e.v=Kr(Ge(t)),t=!1,b.navigator&&b.navigator.sendBeacon&&(t=b.navigator.sendBeacon(e.v.toString(),"")),!t&&b.Image&&((new Image).src=e.v,t=!0),t||(e.g=lc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Mn(e)}cc(n)}function Qr(n){n.g&&(Mi(n),n.g.cancel(),n.g=null)}function nc(n){Qr(n),n.u&&(b.clearTimeout(n.u),n.u=null),Wr(n),n.i.cancel(),n.m&&("number"==typeof n.m&&b.clearTimeout(n.m),n.m=null)}function Oi(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&Hr(n)}function Hr(n){Ku(n.i)||n.m||(n.m=!0,mi(n.Ha,n),n.C=0)}function rc(n,e){var t;t=e?e.m:n.V++;const r=Ge(n.F);U(r,"SID",n.J),U(r,"RID",t),U(r,"AID",n.U),$n(n,r),n.o&&n.s&&Ri(r,n.o,n.s),t=new Fn(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=sc(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Di(n.i,t),xi(t,r,e)}function $n(n,e){n.j&&Ai({},function(t,r){U(e,r,t)})}function sc(n,e,t){t=Math.min(n.l.length,t);var r=n.j?se(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let h=s[u].h;const l=s[u].g;if(h-=i,0>h)i=Math.max(0,s[u].h-100),a=!1;else try{Sf(l,o,"req"+h+"_")}catch(d){r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function ic(n){n.g||n.u||(n.Y=1,mi(n.Ga,n),n.A=0)}function Fi(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Ln(se(n.Ga,n),uc(n,n.A)),n.A++,0))}function Mi(n){null!=n.B&&(b.clearTimeout(n.B),n.B=null)}function oc(n){n.g=new Fn(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=Ge(n.oa);U(e,"RID","rpc"),U(e,"SID",n.J),U(e,"CI",n.N?"0":"1"),U(e,"AID",n.U),$n(n,e),U(e,"TYPE","xmlhttp"),n.o&&n.s&&Ri(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Kr(Ge(e)),t.s=null,t.U=!0,Lu(t,n)}function Wr(n){null!=n.v&&(b.clearTimeout(n.v),n.v=null)}function ac(n,e){var t=null;if(n.g==e){Wr(n),Mi(n),n.g=null;var r=2}else{if(!Ci(n.i,e))return;t=e.D,Gu(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;oe(r=Mr(),new Cu(r,t,e,s)),Hr(n)}else ic(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function(n,e){return!($u(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Ln(se(n.Ha,n,e),uc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Fi(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:It(n,5);break;case 4:It(n,10);break;case 3:It(n,6);break;default:It(n,2)}}function uc(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function It(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=se(n.jb,n);t||(t=new Tt("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Br(t,"https"),Kr(t)),function(n,e){const t=new Fr;if(b.Image){const r=new Image;r.onload=Cr($r,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Cr($r,t,r,"TestLoadImage: error",!1,e),r.onabort=Cr($r,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Cr($r,t,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else _e(2);n.G=0,n.j&&n.j.va(e),cc(n),nc(n)}function cc(n){n.G=0,n.I=-1,n.j&&((0!=zu(n.i).length||0!=n.l.length)&&(n.i.i.length=0,Ws(n.l),n.l.length=0),n.j.ua())}function hc(n,e,t){let r=function(n){return n instanceof Tt?Ge(n):new Tt(n,void 0)}(t);if(""!=r.i)e&&jr(r,e+"."+r.i),Zr(r,r.m);else{const s=b.location;r=function(n,e,t,r){var s=new Tt(null,void 0);return n&&Br(s,n),e&&jr(s,e),t&&Zr(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&Js(n.aa,function(s,i){U(r,i,s)}),t=n.sa,(e=n.D)&&t&&U(r,e,t),U(r,"VER",n.ma),$n(n,r),r}function lc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new K(t&&n.Ba&&!n.qa?new Bn({ib:!0}):n.qa)).L=n.H,e}function dc(){}function Yr(){if(jt&&!(10<=Number($d)))throw Error("Environmental error: no available transport.")}function be(n,e){J.call(this),this.g=new tc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Dr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Dr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Gt(this)}function fc(n){_i.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function mc(){Ti.call(this),this.status=1}function Gt(n){this.g=n}(I=K.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ii.g(),this.C=function(n){return n.h||(n.h=n.i())}(this.u?this.u:Ii),this.g.onreadystatechange=se(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Wu(this,i)}n=t||"";const s=new Kt(this.headers);r&&Ai(r,function(i,o){s.set(o,i)}),r=function(n){e:{var e=kf;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=b.FormData&&n instanceof b.FormData,!(0<=tu(Df,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Xu(this),0<this.B&&((this.K=function(n){return jt&&Kd()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=se(this.pa,this)):this.A=vi(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Wu(this,i)}},I.pa=function(){void 0!==zs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,oe(this,"timeout"),this.abort(8))},I.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,oe(this,"complete"),oe(this,"abort"),zr(this))},I.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zr(this,!0)),K.Z.M.call(this)},I.Fa=function(){this.s||(this.F||this.v||this.l?Ju(this):this.cb())},I.cb=function(){Ju(this)},I.ba=function(){try{return 2<ze(this)?this.g.status:-1}catch(n){return-1}},I.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},I.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),bf(e)}},I.Da=function(){return this.m},I.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(I=tc.prototype).ma=8,I.G=1,I.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},I.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new Fn(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=au(i),cu(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=sc(this,s,e),U(t=Ge(this.F),"RID",n),U(t,"CVER",22),this.D&&U(t,"X-HTTP-Session-Id",this.D),$n(this,t),this.o&&i&&Ri(t,this.o,i),Di(this.i,s),this.Ra&&U(t,"TYPE","init"),this.ja?(U(t,"$req",e),U(t,"SID","null"),s.$=!0,xi(s,t,null)):xi(s,t,e),this.G=2}}else 3==this.G&&(n?rc(this,n):0==this.l.length||Ku(this.i)||rc(this))},I.Ga=function(){if(this.u=null,oc(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Ln(se(this.bb,this),n)}},I.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,_e(10),Qr(this),oc(this))},I.ab=function(){null!=this.v&&(this.v=null,Qr(this),Fi(this),_e(19))},I.jb=function(n){n?(this.h.info("Successfully pinged google.com"),_e(2)):(this.h.info("Failed to ping google.com"),_e(1))},(I=dc.prototype).xa=function(){},I.wa=function(){},I.va=function(){},I.ua=function(){},I.Oa=function(){},Yr.prototype.g=function(n,e){return new be(n,e)},ie(be,J),be.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),mi(se(n.hb,n,e))),_e(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=hc(n,null,n.W),Hr(n)},be.prototype.close=function(){Li(this.g)},be.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Oi(this.g,e)}else this.v?((e={}).__data__=fi(n),Oi(this.g,e)):Oi(this.g,n)},be.prototype.M=function(){this.g.j=null,delete this.j,Li(this.g),delete this.g,be.Z.M.call(this)},ie(fc,_i),ie(mc,Ti),ie(Gt,dc),Gt.prototype.xa=function(){oe(this.g,"a")},Gt.prototype.wa=function(n){oe(this.g,new fc(n))},Gt.prototype.va=function(n){oe(this.g,new mc(n))},Gt.prototype.ua=function(){oe(this.g,"b")},Yr.prototype.createWebChannel=Yr.prototype.g,be.prototype.send=be.prototype.u,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,Pr.NO_ERROR=0,Pr.TIMEOUT=8,Pr.HTTP_ERROR=6,Du.COMPLETE="complete",ku.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",J.prototype.listen=J.prototype.N,K.prototype.listenOnce=K.prototype.O,K.prototype.getLastError=K.prototype.La,K.prototype.getLastErrorCode=K.prototype.Da,K.prototype.getStatus=K.prototype.ba,K.prototype.getResponseJson=K.prototype.Qa,K.prototype.getResponseText=K.prototype.ga,K.prototype.send=K.prototype.ea;var Of=$e.createWebChannelTransport=function(){return new Yr},Ff=$e.getStatEventTarget=function(){return Mr()},Pi=$e.ErrorCode=Pr,Mf=$e.EventType=Du,Pf=$e.Event=vt,gc=$e.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},qf=$e.FetchXmlHttpFactory=Bn,Jr=$e.WebChannel=ku,Uf=$e.XhrIo=K;const pc="@firebase/firestore";class ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ae.UNAUTHENTICATED=new ae(null),ae.GOOGLE_CREDENTIALS=new ae("google-credentials-uid"),ae.FIRST_PARTY=new ae("first-party-uid"),ae.MOCK_USER=new ae("mock-user");let zt="9.6.0";const rt=new yt.Yd("@firebase/firestore");function qi(){return rt.logLevel}function _(n,...e){if(rt.logLevel<=yt.in.DEBUG){const t=e.map(Ui);rt.debug(`Firestore (${zt}): ${n}`,...t)}}function $(n,...e){if(rt.logLevel<=yt.in.ERROR){const t=e.map(Ui);rt.error(`Firestore (${zt}): ${n}`,...t)}}function Gn(n,...e){if(rt.logLevel<=yt.in.WARN){const t=e.map(Ui);rt.warn(`Firestore (${zt}): ${n}`,...t)}}function Ui(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function x(n="Unexpected state"){const e=`FIRESTORE (${zt}) INTERNAL ASSERTION FAILED: `+n;throw $(e),new Error(e)}function A(n,e){n||x()}function T(n,e){return n}const f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class X{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class yc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class jf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ae.UNAUTHENTICATED))}shutdown(){}}class Zf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Kf{constructor(e){this.t=e,this.currentUser=ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=h=>this.i!==s?(s=this.i,t(h)):Promise.resolve();let o=new X;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new X,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=o;e.enqueueRetryable((0,g.Z)(function*(){yield h.promise,yield i(r.currentUser)}))},u=h=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new X)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(A("string"==typeof r.accessToken),new yc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return A(null===e||"string"==typeof e),new ae(e)}}class $f{constructor(e,t,r){this.type="FirstParty",this.user=ae.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class Gf{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new $f(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zf{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=s=>{e.enqueueRetryable(()=>{return null!=(i=s).error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`),t(i.token);var i})};const r=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.g.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.g.getImmediate({optional:!0});s?r(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(A("string"==typeof t.token),new vc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Ce{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.p(r),this.T=r=>t.writeSequenceNumber(r))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Qf(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}Ce.I=-1;class wc{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Qf(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function Qt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function _c(n){return n+"\0"}class ee{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new ee(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class N{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new ee(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Tc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Et(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ic(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class zn{constructor(e,t,r){void 0===t?t=0:t>e.length&&x(),void 0===r?r=e.length-t:r>e.length-t&&x(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===zn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof zn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class F extends zn{construct(e,t,r){return new F(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new F(t)}static emptyPath(){return new F([])}}const Hf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends zn{construct(e,t,r){return new ue(e,t,r)}static isValidIdentifier(e){return Hf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new v(f.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new v(f.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new v(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new v(f.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class Ht{constructor(e){this.fields=e,e.sort(ue.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class te{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new te(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new te(t)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}te.EMPTY_BYTE_STRING=new te("");const Yf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(n){if(A(!!n),"string"==typeof n){let e=0;const t=Yf.exec(n);if(A(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:G(n.seconds),nanos:G(n.nanos)}}function G(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Wt(n){return"string"==typeof n?te.fromBase64String(n):te.fromUint8Array(n)}function Vi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ec(n){const e=n.mapValue.fields.__previous_value__;return Vi(e)?Ec(e):e}function Qn(n){const e=st(n.mapValue.fields.__local_write_time__.timestampValue);return new ee(e.seconds,e.nanos)}function xt(n){return null==n}function Xr(n){return 0===n&&1/n==-1/0}function xc(n){return"number"==typeof n&&Number.isInteger(n)&&!Xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class E{constructor(e){this.path=e}static fromPath(e){return new E(F.fromString(e))}static fromName(e){return new E(F.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===F.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return F.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new E(new F(e.slice()))}}function St(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Vi(n)?4:10:x()}function qe(n,e){const t=St(n);if(t!==St(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qn(n).isEqual(Qn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=st(r.timestampValue),o=st(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Wt(n.bytesValue).isEqual(Wt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return G(r.geoPointValue.latitude)===G(s.geoPointValue.latitude)&&G(r.geoPointValue.longitude)===G(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return G(r.integerValue)===G(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=G(r.doubleValue),o=G(s.doubleValue);return i===o?Xr(i)===Xr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Qt(n.arrayValue.values||[],e.arrayValue.values||[],qe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(Tc(i)!==Tc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!qe(i[a],o[a])))return!1;return!0}(n,e);default:return x()}var s}function Hn(n,e){return void 0!==(n.values||[]).find(t=>qe(t,e))}function Yt(n,e){const t=St(n),r=St(e);if(t!==r)return k(t,r);switch(t){case 0:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=G(s.integerValue||s.doubleValue),a=G(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Sc(n.timestampValue,e.timestampValue);case 4:return Sc(Qn(n),Qn(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,i){const o=Wt(s),a=Wt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const h=k(o[u],a[u]);if(0!==h)return h}return k(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=k(G(s.latitude),G(i.latitude));return 0!==o?o:k(G(s.longitude),G(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const h=Yt(o[u],a[u]);if(h)return h}return k(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){const o=s.fields||{},a=Object.keys(o),u=i.fields||{},h=Object.keys(u);a.sort(),h.sort();for(let l=0;l<a.length&&l<h.length;++l){const d=k(a[l],h[l]);if(0!==d)return d;const m=Yt(o[a[l]],u[h[l]]);if(0!==m)return m}return k(a.length,h.length)}(n.mapValue,e.mapValue);default:throw x()}}function Sc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=st(n),r=st(e),s=k(t.seconds,r.seconds);return 0!==s?s:k(t.nanos,r.nanos)}function Bi(n){return ji(n)}function ji(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=st(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Wt(n.bytesValue).toBase64():"referenceValue"in n?E.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=ji(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${ji(r.fields[a])}`;return i+"}"}(n.mapValue):x();var e}function es(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Zi(n){return!!n&&"integerValue"in n}function Ki(n){return!!n&&"arrayValue"in n}function Ac(n){return!!n&&"nullValue"in n}function bc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ts(n){return!!n&&"mapValue"in n}function Wn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Et(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Wn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Wn(n.arrayValue.values[t]);return e}return Object.assign({},n)}class de{constructor(e){this.value=e}static empty(){return new de({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ts(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wn(t)}setAll(e){let t=ue.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Wn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ts(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ts(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Et(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new de(Wn(this.value))}}function Cc(n){const e=[];return Et(n.fields,(t,r)=>{const s=new ue([t]);if(ts(r)){const i=Cc(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ht(e)}class V{constructor(e,t,r,s,i){this.key=e,this.documentType=t,this.version=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new V(e,0,N.min(),de.empty(),0)}static newFoundDocument(e,t,r){return new V(e,1,t,r,0)}static newNoDocument(e,t){return new V(e,2,t,de.empty(),0)}static newUnknownDocument(e,t){return new V(e,3,t,de.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=de.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=de.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof V&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new V(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Jf{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.R=null}}function Dc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Jf(n,e,t,r,s,i,o)}function Yn(n){const e=T(n);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>function(n){return n.field.canonicalString()+n.op.toString()+Bi(n.value)}(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),xt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ss(e.startAt)),e.endAt&&(t+="|ub:",t+=ss(e.endAt)),e.R=t}return e.R}function ns(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!um(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!qe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Rc(n.startAt,e.startAt)&&Rc(n.endAt,e.endAt)}function rs(n){return E.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class Te extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new tm(e,t,r):"array-contains"===t?new sm(e,r):"in"===t?new im(e,r):"not-in"===t?new om(e,r):"array-contains-any"===t?new am(e,r):new Te(e,t,r)}static P(e,t,r){return"in"===t?new nm(e,r):new rm(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Yt(t,this.value)):null!==t&&St(this.value)===St(t)&&this.v(Yt(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return x()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class tm extends Te{constructor(e,t,r){super(e,t,r),this.key=E.fromName(r.referenceValue)}matches(e){const t=E.comparator(e.key,this.key);return this.v(t)}}class nm extends Te{constructor(e,t){super(e,"in",t),this.keys=Nc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rm extends Te{constructor(e,t){super(e,"not-in",t),this.keys=Nc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Nc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>E.fromName(r.referenceValue))}class sm extends Te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ki(t)&&Hn(t.arrayValue,this.value)}}class im extends Te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Hn(this.value.arrayValue,t)}}class om extends Te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Hn(this.value.arrayValue,t)}}class am extends Te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ki(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Hn(this.value.arrayValue,r))}}class Jn{constructor(e,t){this.position=e,this.before=t}}function ss(n){return`${n.before?"b":"a"}:${n.position.map(e=>Bi(e)).join(",")}`}class Jt{constructor(e,t="asc"){this.field=e,this.dir=t}}function um(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function kc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?E.comparator(E.fromName(o.referenceValue),t.key):Yt(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return n.before?r<=0:r<0}function Rc(n,e){if(null===n)return null===e;if(null===e||n.before!==e.before||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qe(n.position[t],e.position[t]))return!1;return!0}class Qe{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.S=null,this.D=null}}function Lc(n,e,t,r,s,i,o,a){return new Qe(n,e,t,r,s,i,o,a)}function Xt(n){return new Qe(n)}function is(n){return!xt(n.limit)&&"F"===n.limitType}function os(n){return!xt(n.limit)&&"L"===n.limitType}function $i(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Gi(n){for(const e of n.filters)if(e.V())return e.field;return null}function zi(n){return null!==n.collectionGroup}function en(n){const e=T(n);if(null===e.S){e.S=[];const t=Gi(e),r=$i(e);if(null!==t&&null===r)t.isKeyField()||e.S.push(new Jt(t)),e.S.push(new Jt(ue.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.S.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new Jt(ue.keyField(),i))}}}return e.S}function Re(n){const e=T(n);if(!e.D)if("F"===e.limitType)e.D=Dc(e.path,e.collectionGroup,en(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of en(e))t.push(new Jt(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Jn(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Jn(e.startAt.position,!e.startAt.before):null;e.D=Dc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.D}function Oc(n,e,t){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Xn(n,e){return ns(Re(n),Re(e))&&n.limitType===e.limitType}function Fc(n){return`${Yn(Re(n))}|lt:${n.limitType}`}function Qi(n){return`Query(target=${function(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${Bi(r.value)}`;var r}).join(", ")}]`),xt(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: "+ss(n.startAt)),n.endAt&&(e+=", endAt: "+ss(n.endAt)),`Target(${e})`}(Re(n))}; limitType=${n.limitType})`}function er(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):E.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!kc(t.startAt,en(t),r)||t.endAt&&kc(t.endAt,en(t),r)));var t,r}function Mc(n){return(e,t)=>{let r=!1;for(const s of en(n)){const i=cm(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function cm(n,e,t){const r=n.field.isKeyField()?E.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?Yt(a,u):x()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x()}}function Pc(n,e){if(n.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xr(e)?"-0":e}}function qc(n){return{integerValue:""+n}}function Uc(n,e){return xc(e)?qc(e):Pc(n,e)}class as{constructor(){this._=void 0}}function hm(n,e,t){return n instanceof tn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof At?Bc(n,e):n instanceof bt?jc(n,e):function(r,s){const i=Vc(r,s),o=Zc(i)+Zc(r.N);return Zi(i)&&Zi(r.N)?qc(o):Pc(r.k,o)}(n,e)}function lm(n,e,t){return n instanceof At?Bc(n,e):n instanceof bt?jc(n,e):t}function Vc(n,e){return n instanceof nn?Zi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class tn extends as{}class At extends as{constructor(e){super(),this.elements=e}}function Bc(n,e){const t=Kc(e);for(const r of n.elements)t.some(s=>qe(s,r))||t.push(r);return{arrayValue:{values:t}}}class bt extends as{constructor(e){super(),this.elements=e}}function jc(n,e){let t=Kc(e);for(const r of n.elements)t=t.filter(s=>!qe(s,r));return{arrayValue:{values:t}}}class nn extends as{constructor(e,t){super(),this.k=e,this.N=t}}function Zc(n){return G(n.integerValue||n.doubleValue)}function Kc(n){return Ki(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class tr{constructor(e,t){this.field=e,this.transform=t}}class fm{constructor(e,t){this.version=e,this.transformResults=t}}class z{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new z}static exists(e){return new z(void 0,e)}static updateTime(e){return new z(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function us(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class cs{}function mm(n,e,t){n instanceof nr?function(r,s,i){const o=r.value.clone(),a=Qc(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof it?function(r,s,i){if(!us(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Qc(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(zc(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Hi(n,e,t){var s;n instanceof nr?function(r,s,i){if(!us(r.precondition,s))return;const o=r.value.clone(),a=Hc(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument(Gc(s),o).setHasLocalMutations()}(n,e,t):n instanceof it?function(r,s,i){if(!us(r.precondition,s))return;const o=Hc(r.fieldTransforms,i,s),a=s.data;a.setAll(zc(r)),a.setAll(o),s.convertToFoundDocument(Gc(s),a).setHasLocalMutations()}(n,e,t):us(n.precondition,s=e)&&s.convertToNoDocument(N.min())}function gm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Vc(r.transform,s||null);null!=i&&(null==t&&(t=de.empty()),t.set(r.field,i))}return t||null}function $c(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Qt(t,r,(s,i)=>function(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof At&&r instanceof At||t instanceof bt&&r instanceof bt?Qt(t.elements,r.elements,qe):t instanceof nn&&r instanceof nn?qe(t.N,r.N):t instanceof tn&&r instanceof tn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function Gc(n){return n.isFoundDocument()?n.version:N.min()}class nr extends cs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}}class it extends cs{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}}function zc(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Qc(n,e,t){const r=new Map;A(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,lm(o,a,t[s]))}return r}function Hc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,hm(i,o,e))}return r}class rr extends cs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Wi extends cs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class pm{constructor(e){this.count=e}}var Q,R;function Wc(n){switch(n){default:return x();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function Yc(n){if(void 0===n)return $("GRPC error has no .code"),f.UNKNOWN;switch(n){case Q.OK:return f.OK;case Q.CANCELLED:return f.CANCELLED;case Q.UNKNOWN:return f.UNKNOWN;case Q.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case Q.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case Q.INTERNAL:return f.INTERNAL;case Q.UNAVAILABLE:return f.UNAVAILABLE;case Q.UNAUTHENTICATED:return f.UNAUTHENTICATED;case Q.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case Q.NOT_FOUND:return f.NOT_FOUND;case Q.ALREADY_EXISTS:return f.ALREADY_EXISTS;case Q.PERMISSION_DENIED:return f.PERMISSION_DENIED;case Q.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case Q.ABORTED:return f.ABORTED;case Q.OUT_OF_RANGE:return f.OUT_OF_RANGE;case Q.UNIMPLEMENTED:return f.UNIMPLEMENTED;case Q.DATA_LOSS:return f.DATA_LOSS;default:return x()}}(R=Q||(Q={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS";class H{constructor(e,t){this.comparator=e,this.root=t||ce.EMPTY}insert(e,t){return new H(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ce.BLACK,null,null))}remove(e){return new H(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hs(this.root,e,this.comparator,!1)}getReverseIterator(){return new hs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hs(this.root,e,this.comparator,!0)}}class hs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ce{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:ce.RED,this.left=null!=s?s:ce.EMPTY,this.right=null!=i?i:ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ce(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return ce.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw x();const e=this.left.check();if(e!==this.right.check())throw x();return e+(this.isRed()?0:1)}}ce.EMPTY=null,ce.RED=!0,ce.BLACK=!1,ce.EMPTY=new class{constructor(){this.size=0}get key(){throw x()}get value(){throw x()}get color(){throw x()}get left(){throw x()}get right(){throw x()}copy(n,e,t,r,s){return this}insert(n,e,t){return new ce(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class j{constructor(e){this.comparator=e,this.data=new H(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Jc(this.data.getIterator())}getIteratorFrom(e){return new Jc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof j)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new j(this.comparator);return t.data=e,t}}class Jc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const ym=new H(E.comparator);function Le(){return ym}const vm=new H(E.comparator);function Yi(){return vm}const wm=new H(E.comparator);function Xc(){return wm}const _m=new j(E.comparator);function M(...n){let e=_m;for(const t of n)e=e.add(t);return e}const Tm=new j(k);function ls(){return Tm}class sr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,ir.createSynthesizedTargetChangeForCurrentChange(e,t)),new sr(N.min(),r,ls(),Le(),M())}}class ir{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new ir(te.EMPTY_BYTE_STRING,t,M(),M(),M())}}class ds{constructor(e,t,r,s){this.$=e,this.removedTargetIds=t,this.key=r,this.F=s}}class eh{constructor(e,t){this.targetId=e,this.O=t}}class th{constructor(e,t,r=te.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class nh{constructor(){this.M=0,this.L=sh(),this.B=te.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.M}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=M(),t=M(),r=M();return this.L.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x()}}),new ir(this.B,this.U,e,t,r)}H(){this.q=!1,this.L=sh()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}}class Im{constructor(e){this.et=e,this.nt=new Map,this.st=Le(),this.it=rh(),this.rt=new j(k)}ot(e){for(const t of e.$)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ut(e){this.forEachTarget(e,t=>{const r=this.ht(t);switch(e.state){case 0:this.lt(t)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||this.removeTarget(t);break;case 3:this.lt(t)&&(r.tt(),r.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),r.W(e.resumeToken));break;default:x()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((r,s)=>{this.lt(s)&&t(s)})}dt(e){const t=e.targetId,r=e.O.count,s=this.wt(t);if(s){const i=s.target;if(rs(i))if(0===r){const o=new E(i.path);this.ct(t,o,V.newNoDocument(o,N.min()))}else A(1===r);else this._t(t)!==r&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((i,o)=>{const a=this.wt(o);if(a){if(i.current&&rs(a.target)){const u=new E(a.target.path);null!==this.st.get(u)||this.yt(o,u)||this.ct(o,u,V.newNoDocument(u,e))}i.j&&(t.set(o,i.G()),i.H())}});let r=M();this.it.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const h=this.wt(u);return!h||2===h.purpose||(a=!1,!1)}),a&&(r=r.add(i))});const s=new sr(e,t,this.rt,this.st,r);return this.st=Le(),this.it=rh(),this.rt=new j(k),s}at(e,t){if(!this.lt(e))return;const r=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,r),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,r){if(!this.lt(e))return;const s=this.ht(e);this.yt(e,t)?s.J(t,1):s.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),r&&(this.st=this.st.insert(t,r))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new nh,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new j(k),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new nh),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.ct(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function rh(){return new H(E.comparator)}function sh(){return new H(E.comparator)}const Em={asc:"ASCENDING",desc:"DESCENDING"},xm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Sm{constructor(e,t){this.databaseId=e,this.C=t}}function or(n,e){return n.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ih(n,e){return n.C?e.toBase64():e.toUint8Array()}function Am(n,e){return or(n,e.toTimestamp())}function ne(n){return A(!!n),N.fromTimestamp(function(e){const t=st(e);return new ee(t.seconds,t.nanos)}(n))}function Ji(n,e){return(t=n,new F(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function oh(n){const e=F.fromString(n);return A(vh(e)),e}function ar(n,e){return Ji(n.databaseId,e.path)}function Ue(n,e){const t=oh(e);if(t.get(1)!==n.databaseId.projectId)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new E(uh(t))}function Xi(n,e){return Ji(n.databaseId,e)}function ah(n){const e=oh(n);return 4===e.length?F.emptyPath():uh(e)}function ur(n){return new F(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function uh(n){return A(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function ch(n,e,t){return{name:ar(n,e),fields:t.value.mapValue.fields}}function hh(n,e,t){const r=Ue(n,e.name),s=ne(e.updateTime),i=new de({mapValue:{fields:e.fields}}),o=V.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function fs(n,e){let t;if(e instanceof nr)t={update:ch(n,e.key,e.value)};else if(e instanceof rr)t={delete:ar(n,e.key)};else if(e instanceof it)t={update:ch(n,e.key,e.data),updateMask:Fm(e.fieldMask)};else{if(!(e instanceof Wi))return x();t={verify:ar(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof tn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof At)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof bt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof nn)return{fieldPath:i.field.canonicalString(),increment:o.N};throw x()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Am(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:x()),t;var s}function lh(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?z.updateTime(ne(s.updateTime)):void 0!==s.exists?z.exists(s.exists):z.none():z.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(A("REQUEST_TIME"===o.setToServerValue),a=new tn):"appendMissingElements"in o?a=new At(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new bt(o.removeAllFromArray.values||[]):"increment"in o?a=new nn(i,o.increment):x();const u=ue.fromServerFormat(o.fieldPath);return new tr(u,a)}(n,s)):[];var s;if(e.update){const s=Ue(n,e.update.name),i=new de({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ht((e.updateMask.fieldPaths||[]).map(h=>ue.fromServerFormat(h)));return new it(s,i,o,t,r)}return new nr(s,i,t,r)}if(e.delete){const s=Ue(n,e.delete);return new rr(s,t)}if(e.verify){const s=Ue(n,e.verify);return new Wi(s,t)}return x()}function dh(n,e){return{documents:[Xi(n,e.path)]}}function fh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Xi(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Xi(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(a){if(0===a.length)return;const u=a.map(h=>function(l){if("=="===l.op){if(bc(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NAN"}};if(Ac(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NULL"}}}else if("!="===l.op){if(bc(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NOT_NAN"}};if(Ac(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rn(l.field),op:Rm(l.op),value:l.value}}}(h));return 1===u.length?u[0]:{compositeFilter:{op:"AND",filters:u}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(a){if(0!==a.length)return a.map(u=>{return{field:rn((h=u).field),direction:km(h.dir)};var h})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(u=e.limit,n.C||xt(u)?u:{value:u});var u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=ph(e.startAt)),e.endAt&&(t.structuredQuery.endAt=ph(e.endAt)),t}function mh(n){let e=ah(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){A(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=gh(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new Jt(sn((d=l).field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction));var d}));let a=null;t.limit&&(a=function(l){let d;return d="object"==typeof l?l.value:l,xt(d)?null:d}(t.limit));let u=null;t.startAt&&(u=yh(t.startAt));let h=null;return t.endAt&&(h=yh(t.endAt)),Lc(e,s,o,i,a,"F",u,h)}function gh(n){return n?void 0!==n.unaryFilter?[Om(n)]:void 0!==n.fieldFilter?[Lm(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>gh(e)).reduce((e,t)=>e.concat(t)):x():[]}function ph(n){return{before:n.before,values:n.position}}function yh(n){return new Jn(n.values||[],!!n.before)}function km(n){return Em[n]}function Rm(n){return xm[n]}function rn(n){return{fieldPath:n.canonicalString()}}function sn(n){return ue.fromServerFormat(n.fieldPath)}function Lm(n){return Te.create(sn(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return x()}}(n.fieldFilter.op),n.fieldFilter.value)}function Om(n){switch(n.unaryFilter.op){case"IS_NAN":const e=sn(n.unaryFilter.field);return Te.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=sn(n.unaryFilter.field);return Te.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=sn(n.unaryFilter.field);return Te.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=sn(n.unaryFilter.field);return Te.create(s,"!=",{nullValue:"NULL_VALUE"});default:return x()}}function Fm(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Fe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wh(e)),e=Mm(n.get(t),e);return wh(e)}function Mm(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function wh(n){return n+"\x01\x01"}function He(n){const e=n.length;if(A(e>=2),2===e)return A("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),F.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&x(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:x()}i=o+2}return new F(r)}class Pm{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class De{constructor(e,t,r){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=r}}De.store="owner",De.key="owner";class ot{constructor(e,t,r){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=r}}ot.store="mutationQueues",ot.keyPath="userId";class P{constructor(e,t,r,s,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}}P.store="mutations",P.keyPath="batchId",P.userMutationsIndex="userMutationsIndex",P.userMutationsKeyPath=["userId","batchId"];class fe{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Fe(t)]}static key(e,t,r){return[e,Fe(t),r]}}fe.store="documentMutations",fe.PLACEHOLDER=new fe;class qm{constructor(e,t){this.path=e,this.readTime=t}}class Um{constructor(e,t){this.path=e,this.version=t}}class Z{constructor(e,t,r,s,i,o){this.unknownDocument=e,this.noDocument=t,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}}Z.store="remoteDocuments",Z.readTimeIndex="readTimeIndex",Z.readTimeIndexPath="readTime",Z.collectionReadTimeIndex="collectionReadTimeIndex",Z.collectionReadTimeIndexPath=["parentPath","readTime"];class Ve{constructor(e){this.byteSize=e}}Ve.store="remoteDocumentGlobal",Ve.key="remoteDocumentGlobalKey";class xe{constructor(e,t,r,s,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}}xe.store="targets",xe.keyPath="targetId",xe.queryTargetsIndexName="queryTargetsIndex",xe.queryTargetsKeyPath=["canonicalId","targetId"];class he{constructor(e,t,r){this.targetId=e,this.path=t,this.sequenceNumber=r}}he.store="targetDocuments",he.keyPath=["targetId","path"],he.documentTargetsIndex="documentTargetsIndex",he.documentTargetsKeyPath=["path","targetId"];class Ne{constructor(e,t,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=r,this.targetCount=s}}Ne.key="targetGlobalKey",Ne.store="targetGlobal";class Ct{constructor(e,t){this.collectionId=e,this.parent=t}}Ct.store="collectionParents",Ct.keyPath=["collectionId","parent"];class We{constructor(e,t,r,s){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=r,this.inForeground=s}}We.store="clientMetadata",We.keyPath="clientId";class on{constructor(e,t,r){this.bundleId=e,this.createTime=t,this.version=r}}on.store="bundles",on.keyPath="bundleId";class an{constructor(e,t,r){this.name=e,this.readTime=t,this.bundledQuery=r}}an.store="namedQueries",an.keyPath="name";const Vm=[ot.store,P.store,fe.store,Z.store,xe.store,De.store,Ne.store,he.store,We.store,Ve.store,Ct.store,on.store,an.store],_h="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Th{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(s=>s?y.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}}class ms{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new X,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new cr(e,t.error)):this.It.resolve()},this.transaction.onerror=r=>{const s=eo(r.target.error);this.It.reject(new cr(e,s))}}static open(e,t,r,s){try{return new ms(t,e.transaction(s,r))}catch(i){throw new cr(t,i)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new jm(t)}}class Me{constructor(e,t,r){this.name=e,this.version=t,this.Rt=r,12.2===Me.Pt((0,O.z$)())&&$("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),Nt(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!(0,O.hl)())return!1;if(Me.vt())return!0;const e=(0,O.z$)(),t=Me.Pt(e),r=0<t&&t<10,s=Me.Vt(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static vt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static Pt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}Ct(e){var t=this;return(0,g.Z)(function*(){return t.db||(_("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new cr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new v(f.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(f.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new cr(e,a))},i.onupgradeneeded=o=>{_("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.Rt.Nt(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{_("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.kt&&(t.db.onversionchange=r=>t.kt(r)),t.db})()}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,g.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.Ct(e);const u=ms.open(i.db,e,o?"readonly":"readwrite",r),h=s(u).catch(l=>(u.abort(l),y.reject(l))).toPromise();return h.catch(()=>{}),yield u.At,h}catch(u){const h="FirebaseError"!==u.name&&a<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",h),i.close(),!h)return Promise.reject(u)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Bm{constructor(e){this.$t=e,this.Ft=!1,this.Ot=null}get isDone(){return this.Ft}get Mt(){return this.Ot}set cursor(e){this.$t=e}done(){this.Ft=!0}Lt(e){this.Ot=e}delete(){return Nt(this.$t.delete())}}class cr extends v{constructor(e,t){super(f.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Dt(n){return"IndexedDbTransactionError"===n.name}class jm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(_("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Nt(r)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),Nt(this.store.add(e))}get(e){return Nt(this.store.get(e)).next(t=>(void 0===t&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),Nt(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),Nt(this.store.count())}Bt(e,t){const r=this.cursor(this.options(e,t)),s=[];return this.Ut(r,(i,o)=>{s.push(o)}).next(()=>s)}qt(e,t){_("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Kt=!1;const s=this.cursor(r);return this.Ut(s,(i,o,a)=>a.delete())}jt(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.Ut(s,t)}Qt(e){const t=this.cursor({});return new y((r,s)=>{t.onerror=i=>{const o=eo(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}Ut(e,t){const r=[];return new y((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Bm(a),h=t(a.primaryKey,a.value,u);if(h instanceof y){const l=h.catch(d=>(u.done(),y.reject(d)));r.push(l)}u.isDone?s():null===u.Mt?a.continue():a.continue(u.Mt)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Kt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Nt(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=eo(r.target.error);t(s)}})}let Ih=!1;function eo(n){const e=Me.Pt((0,O.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ih||(Ih=!0,setTimeout(()=>{throw r},0)),r}}return n}class Eh extends Th{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function Se(n,e){const t=T(n);return Me.Dt(t.Wt,e)}class to{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&mm(i,e,r[s])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Hi(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Hi(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(N.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),M())}isEqual(e){return this.batchId===e.batchId&&Qt(this.mutations,e.mutations,(t,r)=>$c(t,r))&&Qt(this.baseMutations,e.baseMutations,(t,r)=>$c(t,r))}}class no{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){A(e.mutations.length===r.length);let s=Xc();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new no(e,t,r,s)}}class at{constructor(e,t,r,s,i=N.min(),o=N.min(),a=te.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new at(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new at(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class xh{constructor(e){this.Gt=e}}function ro(n,e){if(e.document)return hh(n.Gt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=E.fromSegments(e.noDocument.path),r=cn(e.noDocument.readTime),s=V.newNoDocument(t,r);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=E.fromSegments(e.unknownDocument.path),r=cn(e.unknownDocument.version);return V.newUnknownDocument(t,r)}return x()}function Sh(n,e,t){const r=so(t),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i={name:ar(a=n.Gt,(u=e).key),fields:u.data.value.mapValue.fields,updateTime:or(a,u.version.toTimestamp())};return new Z(null,null,i,e.hasCommittedMutations,r,s)}var a,u;if(e.isNoDocument()){const i=e.key.path.toArray(),o=un(e.version),a=e.hasCommittedMutations;return new Z(null,new qm(i,o),null,a,r,s)}if(e.isUnknownDocument()){const i=e.key.path.toArray(),o=un(e.version);return new Z(new Um(i,o),null,null,!0,r,s)}return x()}function so(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ah(n){const e=new ee(n[0],n[1]);return N.fromTimestamp(e)}function un(n){const e=n.toTimestamp();return new Pm(e.seconds,e.nanoseconds)}function cn(n){const e=new ee(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function hn(n,e){const t=(e.baseMutations||[]).map(i=>lh(n.Gt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>lh(n.Gt,i)),s=ee.fromMillis(e.localWriteTimeMs);return new to(e.batchId,s,t,r)}function hr(n){const e=cn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?cn(n.lastLimboFreeSnapshotVersion):N.min();let r;var s;return void 0!==n.query.documents?(A(1===(s=n.query).documents.length),r=Re(Xt(ah(s.documents[0])))):r=Re(mh(n.query)),new at(r,n.targetId,0,n.lastListenSequenceNumber,e,t,te.fromBase64String(n.resumeToken))}function bh(n,e){const t=un(e.snapshotVersion),r=un(e.lastLimboFreeSnapshotVersion);let s;s=rs(e.target)?dh(n.Gt,e.target):fh(n.Gt,e.target);const i=e.resumeToken.toBase64();return new xe(e.targetId,Yn(e.target),t,i,e.sequenceNumber,r,s)}function io(n){const e=mh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Oc(e,e.limit,"L"):e}class Zm{getBundleMetadata(e,t){return Ch(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:cn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Ch(e).put({bundleId:(r=t).id,createTime:un(ne(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Dh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:io(s.bundledQuery),readTime:cn(s.readTime)};var s})}saveNamedQuery(e,t){return Dh(e).put({name:(r=t).name,readTime:un(ne(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Ch(n){return Se(n,on.store)}function Dh(n){return Se(n,an.store)}class Km{constructor(){this.zt=new oo}addToCollectionParentIndex(e,t){return this.zt.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this.zt.getEntries(t))}}class oo{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new j(F.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new j(F.comparator)).toArray()}}class $m{constructor(){this.Ht=new oo}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ht.add(t)});const i={collectionId:r,parent:Fe(s)};return Nh(e).put(i)}return y.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[_c(t),""],!1,!0);return Nh(e).Bt(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(He(o.parent))}return r})}}function Nh(n){return Se(n,Ct.store)}const kh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ae{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ae(e,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Rh(n,e,t){const r=n.store(P.store),s=n.store(fe.store),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.jt({range:o},(l,d,m)=>(a++,m.delete()));i.push(u.next(()=>{A(1===a)}));const h=[];for(const l of t.mutations){const d=fe.key(e,l.key.path,t.batchId);i.push(s.delete(d)),h.push(l.key)}return y.waitFor(i).next(()=>h)}function gs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw x();e=n.noDocument}return JSON.stringify(e).length}Ae.DEFAULT_COLLECTION_PERCENTILE=10,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ae.DEFAULT=new Ae(41943040,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ae.DISABLED=new Ae(-1,0,0);class ao{constructor(e,t,r,s){this.userId=e,this.k=t,this.Jt=r,this.referenceDelegate=s,this.Yt={}}static Xt(e,t,r,s){A(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new ao(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).jt({index:P.userMutationsIndex,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ln(e),o=ut(e);return o.add({}).next(a=>{A("number"==typeof a);const u=new to(a,t,r,s),h=function(m,p,w){const S=w.baseMutations.map(Y=>fs(m.Gt,Y)),C=w.mutations.map(Y=>fs(m.Gt,Y));return new P(p,w.batchId,w.localWriteTime.toMillis(),S,C)}(this.k,this.userId,u),l=[];let d=new j((m,p)=>k(m.canonicalString(),p.canonicalString()));for(const m of s){const p=fe.key(this.userId,m.key.path,a);d=d.add(m.key.path.popLast()),l.push(o.put(h)),l.push(i.put(p,fe.PLACEHOLDER))}return d.forEach(m=>{l.push(this.Jt.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Yt[a]=u.keys()}),y.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return ut(e).get(t).next(r=>r?(A(r.userId===this.userId),hn(this.k,r)):null)}Zt(e,t){return this.Yt[t]?y.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Yt[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ut(e).jt({index:P.userMutationsIndex,range:s},(o,a,u)=>{a.userId===this.userId&&(A(a.batchId>=r),i=hn(this.k,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ut(e).jt({index:P.userMutationsIndex,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ut(e).Bt(P.userMutationsIndex,t).next(r=>r.map(s=>hn(this.k,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=fe.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ln(e).jt({range:s},(o,a,u)=>{const[h,l,d]=o,m=He(l);if(h===this.userId&&t.path.isEqual(m))return ut(e).get(d).next(p=>{if(!p)throw x();A(p.userId===this.userId),i.push(hn(this.k,p))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);const s=[];return t.forEach(i=>{const o=fe.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=ln(e).jt({range:a},(h,l,d)=>{const[m,p,w]=h,S=He(p);m===this.userId&&i.path.isEqual(S)?r=r.add(w):d.done()});s.push(u)}),y.waitFor(s).next(()=>this.te(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=fe.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new j(k);return ln(e).jt({range:o},(u,h,l)=>{const[d,m,p]=u,w=He(m);d===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(p)):l.done()}).next(()=>this.te(e,a))}te(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ut(e).get(i).next(o=>{if(null===o)throw x();A(o.userId===this.userId),r.push(hn(this.k,o))}))}),y.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Rh(e.Wt,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ee(t.batchId)}),y.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound(fe.prefixForUser(this.userId)),s=[];return ln(e).jt({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=He(i[1]);s.push(u)}else a.done()}).next(()=>{A(0===s.length)})})}containsKey(e,t){return Lh(e,this.userId,t)}ne(e){return Oh(e).get(this.userId).next(t=>t||new ot(this.userId,-1,""))}}function Lh(n,e,t){const r=fe.prefixForPath(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ln(n).jt({range:i,Kt:!0},(a,u,h)=>{const[l,d,m]=a;l===e&&d===s&&(o=!0),h.done()}).next(()=>o)}function ut(n){return Se(n,P.store)}function ln(n){return Se(n,fe.store)}function Oh(n){return Se(n,ot.store)}class kt{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new kt(0)}static re(){return new kt(-1)}}class Gm{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next(t=>{const r=new kt(t.highestTargetId);return t.highestTargetId=r.next(),this.ae(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.oe(e).next(t=>N.fromTimestamp(new ee(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.oe(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.oe(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.ae(e,s)))}addTargetData(e,t){return this.ce(e,t).next(()=>this.oe(e).next(r=>(r.targetCount+=1,this.ue(t,r),this.ae(e,r))))}updateTargetData(e,t){return this.ce(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dn(e).delete(t.targetId)).next(()=>this.oe(e)).next(r=>(A(r.targetCount>0),r.targetCount-=1,this.ae(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return dn(e).jt((o,a)=>{const u=hr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>y.waitFor(i)).next(()=>s)}forEachTarget(e,t){return dn(e).jt((r,s)=>{const i=hr(s);t(i)})}oe(e){return Fh(e).get(Ne.key).next(t=>(A(null!==t),t))}ae(e,t){return Fh(e).put(Ne.key,t)}ce(e,t){return dn(e).put(bh(this.k,t))}ue(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.oe(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Yn(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return dn(e).jt({range:s,index:xe.queryTargetsIndexName},(o,a,u)=>{const h=hr(a);ns(t,h.target)&&(i=h,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ct(e);return t.forEach(o=>{const a=Fe(o.path);s.push(i.put(new he(r,a))),s.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(s)}removeMatchingKeys(e,t,r){const s=ct(e);return y.forEach(t,i=>{const o=Fe(i.path);return y.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ct(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ct(e);let i=M();return s.jt({range:r,Kt:!0},(o,a,u)=>{const h=He(o[1]),l=new E(h);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=Fe(t.path),s=IDBKeyRange.bound([r],[_c(r)],!1,!0);let i=0;return ct(e).jt({index:he.documentTargetsIndex,Kt:!0,range:s},([o,a],u,h)=>{0!==o&&(i++,h.done())}).next(()=>i>0)}Et(e,t){return dn(e).get(t).next(r=>r?hr(r):null)}}function dn(n){return Se(n,xe.store)}function Fh(n){return Se(n,Ne.store)}function ct(n){return Se(n,he.store)}function Rt(n){return uo.apply(this,arguments)}function uo(){return uo=(0,g.Z)(function*(n){if(n.code!==f.FAILED_PRECONDITION||n.message!==_h)throw n;_("LocalStore","Unexpectedly lost primary lease")}),uo.apply(this,arguments)}function Mh([n,e],[t,r]){const s=k(n,t);return 0===s?k(e,r):s}class zm{constructor(e){this.he=e,this.buffer=new j(Mh),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Mh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qm{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){var t=this;const r=this.we?3e5:6e4;_("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,g.Z)(function*(){t._e=null,t.we=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(s){Dt(s)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield Rt(s)}yield t.me(e)}))}}class Hm{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve(Ce.I);const r=new zm(t);return this.ge.forEachTarget(e,s=>r.de(s.sequenceNumber)).next(()=>this.ge.pe(e,s=>r.de(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.ge.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(kh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kh):this.Te(e,t))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let r,s,i,o,a,u,h;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(h=Date.now(),qi()<=yt.in.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${d} documents in `+(h-u)+`ms\nTotal Duration: ${h-l}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}class Wm{constructor(e,t){this.db=e,this.garbageCollector=new Hm(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Ee(e){let t=0;return this.pe(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,(r,s)=>t(s))}addReference(e,t,r){return ps(e,r)}removeReference(e,t,r){return ps(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ps(e,t)}Ae(e,t){return function(r,s){let i=!1;return Oh(r).Qt(o=>Lh(r,o,s).next(a=>(a&&(i=!0),y.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ie(e,(o,a)=>{if(a<=t){const u=this.Ae(e,o).next(h=>{if(!h)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o),ct(e).delete([0,Fe(o.path)])))});s.push(u)}}).next(()=>y.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ps(e,t)}Ie(e,t){const r=ct(e);let s,i=Ce.I;return r.jt({index:he.documentTargetsIndex},([o,a],{path:u,sequenceNumber:h})=>{0===o?(i!==Ce.I&&t(new E(He(s)),i),i=h,s=u):i=Ce.I}).next(()=>{i!==Ce.I&&t(new E(He(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ps(n,e){return ct(n).put((r=n.currentSequenceNumber,new he(0,Fe(e.path),r)));var r}class fn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0!==s){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t])}else this.inner[r]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),!0;return!1}forEach(e){Et(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ic(this.inner)}}class Ph{constructor(){this.changes=new fn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:N.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:V.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ym{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,r){return ht(e).put(ys(t),r)}removeEntry(e,t){const r=ht(e),s=ys(t);return r.delete(s)}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Re(e,r)))}getEntry(e,t){return ht(e).get(ys(t)).next(r=>this.Pe(t,r))}be(e,t){return ht(e).get(ys(t)).next(r=>({document:this.Pe(t,r),size:gs(r)}))}getEntries(e,t){let r=Le();return this.ve(e,t,(s,i)=>{const o=this.Pe(s,i);r=r.insert(s,o)}).next(()=>r)}Ve(e,t){let r=Le(),s=new H(E.comparator);return this.ve(e,t,(i,o)=>{const a=this.Pe(i,o);r=r.insert(i,a),s=s.insert(i,gs(o))}).next(()=>({documents:r,Se:s}))}ve(e,t,r){if(t.isEmpty())return y.resolve();const s=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return ht(e).jt({range:s},(a,u,h)=>{const l=E.fromSegments(a);for(;o&&E.comparator(o,l)<0;)r(o,null),o=i.getNext();o&&o.isEqual(l)&&(r(o,u),o=i.hasNext()?i.getNext():null),o?h.Lt(o.path.toArray()):h.done()}).next(()=>{for(;o;)r(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=t.path.length+1,o={};if(r.isEqual(N.min())){const a=t.path.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.path.toArray(),u=so(r);o.range=IDBKeyRange.lowerBound([a,u],!0),o.index=Z.collectionReadTimeIndex}return ht(e).jt(o,(a,u,h)=>{if(a.length!==i)return;const l=ro(this.k,u);t.path.isPrefixOf(l.key.path)?er(t,l)&&(s=s.insert(l.key,l)):h.done()}).next(()=>s)}newChangeBuffer(e){return new Jm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return qh(e).get(Ve.key).next(t=>(A(!!t),t))}Re(e,t){return qh(e).put(Ve.key,t)}Pe(e,t){if(t){const r=ro(this.k,t);if(!r.isNoDocument()||!r.version.isEqual(N.min()))return r}return V.newInvalidDocument(e)}}class Jm extends Ph{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new fn(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new j((i,o)=>k(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Ce.get(i);if(o.document.isValidDocument()){const u=Sh(this.De.k,o.document,this.getReadTime(i));s=s.add(i.path.popLast()),r+=gs(u)-a,t.push(this.De.addEntry(e,i,u))}else if(r-=a,this.trackRemovals){const u=Sh(this.De.k,V.newNoDocument(i,N.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,u))}else t.push(this.De.removeEntry(e,i))}),s.forEach(i=>{t.push(this.De.Jt.addToCollectionParentIndex(e,i))}),t.push(this.De.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.De.be(e,t).next(r=>(this.Ce.set(t,r.size),r.document))}getAllFromCache(e,t){return this.De.Ve(e,t).next(({documents:r,Se:s})=>(s.forEach((i,o)=>{this.Ce.set(i,o)}),r))}}function qh(n){return Se(n,Ve.store)}function ht(n){return Se(n,Z.store)}function ys(n){return n.path.toArray()}class Xm{constructor(e){this.k=e}Nt(e,t,r,s){A(r<s&&r>=0&&s<=11);const i=new ms("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore(De.store),(a=e).createObjectStore(ot.store,{keyPath:ot.keyPath}),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0}),a.createObjectStore(fe.store),Uh(e),function(a){a.createObjectStore(Z.store)}(e));let o=y.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore(he.store),a.deleteObjectStore(xe.store),a.deleteObjectStore(Ne.store)}(e),Uh(e)),o=o.next(()=>function(a){const u=a.store(Ne.store),h=new Ne(0,0,N.min().toTimestamp(),0);return u.put(Ne.key,h)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store(P.store).Bt().next(h=>{a.deleteObjectStore(P.store),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0});const l=u.store(P.store),d=h.map(m=>l.put(m));return y.waitFor(d)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore(We.store,{keyPath:We.keyPath})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Ne(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore(Ve.store)}(e),this.ke(i)))),r<7&&s>=7&&(o=o.next(()=>this.xe(i))),r<8&&s>=8&&(o=o.next(()=>this.$e(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const u=a.objectStore(Z.store);u.createIndex(Z.readTimeIndex,Z.readTimeIndexPath,{unique:!1}),u.createIndex(Z.collectionReadTimeIndex,Z.collectionReadTimeIndexPath,{unique:!1})}(t)})),r<10&&s>=10&&(o=o.next(()=>this.Fe(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(on.store,{keyPath:on.keyPath})})(e),function(a){a.createObjectStore(an.store,{keyPath:an.keyPath})}(e)})),o}ke(e){let t=0;return e.store(Z.store).jt((r,s)=>{t+=gs(s)}).next(()=>{const r=new Ve(t);return e.store(Ve.store).put(Ve.key,r)})}Ne(e){const t=e.store(ot.store),r=e.store(P.store);return t.Bt().next(s=>y.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.Bt(P.userMutationsIndex,o).next(a=>y.forEach(a,u=>{A(u.userId===i.userId);const h=hn(this.k,u);return Rh(e,i.userId,h).next(()=>{})}))}))}xe(e){const t=e.store(he.store),r=e.store(Z.store);return e.store(Ne.store).get(Ne.key).next(s=>{const i=[];return r.jt((o,a)=>{const u=new F(o),h=[0,Fe(u)];i.push(t.get(h).next(l=>l?y.resolve():t.put(new he(0,Fe(u),s.highestListenSequenceNumber))))}).next(()=>y.waitFor(i))})}$e(e,t){e.createObjectStore(Ct.store,{keyPath:Ct.keyPath});const r=t.store(Ct.store),s=new oo,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Fe(u)})}};return t.store(Z.store).jt({Kt:!0},(o,a)=>{const u=new F(o);return i(u.popLast())}).next(()=>t.store(fe.store).jt({Kt:!0},([o,a,u],h)=>{const l=He(a);return i(l.popLast())}))}Fe(e){const t=e.store(xe.store);return t.jt((r,s)=>{const i=hr(s),o=bh(this.k,i);return t.put(o)})}}function Uh(n){n.createObjectStore(he.store,{keyPath:he.keyPath}).createIndex(he.documentTargetsIndex,he.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(xe.store,{keyPath:xe.keyPath}).createIndex(xe.queryTargetsIndexName,xe.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(Ne.store)}const co="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ho{constructor(e,t,r,s,i,o,a,u,h,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Oe=i,this.window=o,this.document=a,this.Me=h,this.Le=l,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=d=>Promise.resolve(),!ho.bt())throw new v(f.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wm(this,s),this.Ge=t+"main",this.k=new xh(u),this.ze=new Me(this.Ge,11,new Xm(this.k)),this.He=new Gm(this.referenceDelegate,this.k),this.Jt=new $m,this.Je=new Ym(this.k,this.Jt),this.Ye=new Zm,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===l&&$("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,co);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.He.getHighestSequenceNumber(e))}).then(e=>{this.Be=new Ce(e,this.Me)}).then(()=>{this.Ue=!0}).catch(e=>(this.ze&&this.ze.close(),Promise.reject(e)))}sn(e){var t=this;return this.We=function(){var r=(0,g.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt(function(){var t=(0,g.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,g.Z)(function*(){t.started&&(yield t.Ze())})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>vs(e).put(new We(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(e).next(t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(e)).next(t=>this.isPrimary&&!t?this.an(e).next(()=>!1):!!t&&this.cn(e).next(()=>!0))).catch(e=>{if(Dt(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.We(e)),this.isPrimary=e})}rn(e){return lr(e).get(De.key).next(t=>y.resolve(this.un(t)))}hn(e){return vs(e).delete(this.clientId)}ln(){var e=this;return(0,g.Z)(function*(){if(e.isPrimary&&!e.fn(e.Qe,18e5)){e.Qe=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=Se(r,We.store);return s.Bt().next(i=>{const o=e.dn(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return y.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Xe)for(const r of t)e.Xe.removeItem(e.wn(r.clientId))}})()}nn(){this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?y.resolve(!0):lr(e).get(De.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,co);return!1}}return!(!this.networkEnabled||!this.inForeground)||vs(e).Bt().next(r=>void 0===this.dn(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,g.Z)(function*(){e.Ue=!1,e.mn(),e.je&&(e.je.cancel(),e.je=null),e.gn(),e.yn(),yield e.ze.runTransaction("shutdown","readwrite",[De.store,We.store],t=>{const r=new Eh(t,Ce.I);return e.an(r).next(()=>e.hn(r))}),e.ze.close(),e.pn()})()}dn(e,t){return e.filter(r=>this.fn(r.updateTimeMs,t)&&!this._n(r.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",e=>vs(e).Bt().next(t=>this.dn(t,18e5).map(r=>r.clientId)))}get started(){return this.Ue}getMutationQueue(e){return ao.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,r){let i;return _("IndexedDbPersistence","Starting transaction:",e),this.ze.runTransaction(e,"readonly"===t?"readonly":"readwrite",Vm,o=>(i=new Eh(o,this.Be?this.Be.next():Ce.I),"readwrite-primary"===t?this.rn(i).next(a=>!!a||this.on(i)).next(a=>{if(!a)throw $(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)),new v(f.FAILED_PRECONDITION,_h);return r(i)}).next(a=>this.cn(i).next(()=>a)):this.En(i).next(()=>r(i)))).then(o=>(i.raiseOnCommittedEvent(),o))}En(e){return lr(e).get(De.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)&&!this.un(t)&&!(this.Le||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(f.FAILED_PRECONDITION,co)})}cn(e){const t=new De(this.clientId,this.allowTabSynchronization,Date.now());return lr(e).put(De.key,t)}static bt(){return Me.bt()}an(e){const t=lr(e);return t.get(De.key).next(r=>this.un(r)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete(De.key)):y.resolve())}fn(e,t){const r=Date.now();return!(e<r-t||e>r&&($(`Detected an update time that is in the future: ${e} > ${r}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),(0,O.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const r=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return _("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return $("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(e){$("Failed to set zombie client id.",e)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(e){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lr(n){return Se(n,De.store)}function vs(n){return Se(n,We.store)}function lo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class eg{constructor(e,t){this.progress=e,this.In=t}}class Vh{constructor(e,t,r){this.Je=e,this.An=t,this.Jt=r}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.Pn(e,t,r))}Pn(e,t,r){return this.Je.getEntry(e,t).next(s=>{for(const i of r)i.applyToLocalView(s);return s})}bn(e,t){e.forEach((r,s)=>{for(const i of t)i.applyToLocalView(s)})}vn(e,t){return this.Je.getEntries(e,t).next(r=>this.Vn(e,r).next(()=>r))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.bn(t,r))}getDocumentsMatchingQuery(e,t,r){return E.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.Sn(e,t.path):zi(t)?this.Dn(e,t,r):this.Cn(e,t,r);var s}Sn(e,t){return this.Rn(e,new E(t)).next(r=>{let s=Yi();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Dn(e,t,r){const s=t.collectionGroup;let i=Yi();return this.Jt.getCollectionParents(e,s).next(o=>y.forEach(o,a=>{const u=(h=t,l=a.child(s),new Qe(l,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,l;return this.Cn(e,u,r).next(h=>{h.forEach((l,d)=>{i=i.insert(l,d)})})}).next(()=>i))}Cn(e,t,r){let s,i;return this.Je.getDocumentsMatchingQuery(e,t,r).next(o=>(s=o,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(o=>(i=o,this.Nn(e,i,s).next(a=>{s=a;for(const u of i)for(const h of u.mutations){const l=h.key;let d=s.get(l);null==d&&(d=V.newInvalidDocument(l),s=s.insert(l,d)),Hi(h,d,u.localWriteTime),d.isFoundDocument()||(s=s.remove(l))}}))).next(()=>(s.forEach((o,a)=>{er(t,a)||(s=s.remove(o))}),s))}Nn(e,t,r){let s=M();for(const o of t)for(const a of o.mutations)a instanceof it&&null===r.get(a.key)&&(s=s.add(a.key));let i=r;return this.Je.getEntries(e,s).next(o=>(o.forEach((a,u)=>{u.isFoundDocument()&&(i=i.insert(a,u))}),i))}}class fo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.kn=r,this.xn=s}static $n(e,t){let r=M(),s=M();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new fo(e,t.fromCache,r,s)}}class Bh{Fn(e){this.On=e}getDocumentsMatchingQuery(e,t,r,s){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||r.isEqual(N.min())?this.Mn(e,t):this.On.vn(e,s).next(i=>{const o=this.Ln(t,i);return(is(t)||os(t))&&this.Bn(t.limitType,o,s,r)?this.Mn(e,t):(qi()<=yt.in.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Qi(t)),this.On.getDocumentsMatchingQuery(e,t,r).next(a=>(o.forEach(u=>{a=a.insert(u.key,u)}),a)))});var i}Ln(e,t){let r=new j(Mc(e));return t.forEach((s,i)=>{er(e,i)&&(r=r.add(i))}),r}Bn(e,t,r,s){if(r.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Mn(e,t){return qi()<=yt.in.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Qi(t)),this.On.getDocumentsMatchingQuery(e,t,N.min())}}class tg{constructor(e,t,r,s){this.persistence=e,this.Un=t,this.k=s,this.qn=new H(k),this.Kn=new fn(i=>Yn(i),ns),this.jn=N.min(),this.An=e.getMutationQueue(r),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new Vh(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function jh(n,e,t,r){return new tg(n,e,t,r)}function Zh(n,e){return mo.apply(this,arguments)}function mo(){return mo=(0,g.Z)(function*(n,e){const t=T(n);let r=t.An,s=t.Wn;const i=yield t.persistence.runTransaction("Handle user change","readonly",o=>{let a;return t.An.getAllMutationBatches(o).next(u=>(a=u,r=t.persistence.getMutationQueue(e),s=new Vh(t.Qn,r,t.persistence.getIndexManager()),r.getAllMutationBatches(o))).next(u=>{const h=[],l=[];let d=M();for(const m of a){h.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}for(const m of u){l.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}return s.vn(o,d).next(m=>({Gn:m,removedBatchIds:h,addedBatchIds:l}))})});return t.An=r,t.Wn=s,t.Un.Fn(t.Wn),i}),mo.apply(this,arguments)}function ng(n,e){const t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Qn.newChangeBuffer({trackRemovals:!0});return function(o,a,u,h){const l=u.batch,d=l.keys();let m=y.resolve();return d.forEach(p=>{m=m.next(()=>h.getEntry(a,p)).next(w=>{const S=u.docVersions.get(p);A(null!==S),w.version.compareTo(S)<0&&(l.applyToRemoteDocument(w,u),w.isValidDocument()&&h.addEntry(w,u.commitVersion))})}),m.next(()=>o.An.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.An.performConsistencyCheck(r)).next(()=>t.Wn.vn(r,s))})}function Kh(n){const e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.He.getLastRemoteSnapshotVersion(t))}function rg(n,e){const t=T(n),r=e.snapshotVersion;let s=t.qn;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Qn.newChangeBuffer({trackRemovals:!0});s=t.qn;const a=[];e.targetChanges.forEach((h,l)=>{const d=s.get(l);if(!d)return;a.push(t.He.removeMatchingKeys(i,h.removedDocuments,l).next(()=>t.He.addMatchingKeys(i,h.addedDocuments,l)));const m=h.resumeToken;if(m.approximateByteSize()>0){const p=d.withResumeToken(m,r).withSequenceNumber(i.currentSequenceNumber);s=s.insert(l,p),w=d,C=h,A((S=p).resumeToken.approximateByteSize()>0),(0===w.resumeToken.approximateByteSize()||S.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8||C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0)&&a.push(t.He.updateTargetData(i,p))}var w,S,C});let u=Le();if(e.documentUpdates.forEach((h,l)=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push($h(i,o,e.documentUpdates,r,void 0).next(h=>{u=h})),!r.isEqual(N.min())){const h=t.He.getLastRemoteSnapshotVersion(i).next(l=>t.He.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return y.waitFor(a).next(()=>o.apply(i)).next(()=>t.Wn.Vn(i,u)).next(()=>u)}).then(i=>(t.qn=s,i))}function $h(n,e,t,r,s){let i=M();return t.forEach(o=>i=i.add(o)),e.getEntries(n,i).next(o=>{let a=Le();return t.forEach((u,h)=>{const l=o.get(u),d=(null==s?void 0:s.get(u))||r;h.isNoDocument()&&h.version.isEqual(N.min())?(e.removeEntry(u,d),a=a.insert(u,h)):!l.isValidDocument()||h.version.compareTo(l.version)>0||0===h.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(h,d),a=a.insert(u,h)):_("LocalStore","Ignoring outdated watch update for ",u,". Current version:",l.version," Watch version:",h.version)}),a})}function sg(n,e){const t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.An.getNextMutationBatchAfterBatchId(r,e)))}function mn(n,e){const t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.He.getTargetData(r,e).next(i=>i?(s=i,y.resolve(s)):t.He.allocateTargetId(r).next(o=>(s=new at(e,o,0,r.currentSequenceNumber),t.He.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.qn.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qn=t.qn.insert(r.targetId,r),t.Kn.set(e,r.targetId)),r})}function gn(n,e,t){return go.apply(this,arguments)}function go(){return go=(0,g.Z)(function*(n,e,t){const r=T(n),s=r.qn.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Dt(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.qn=r.qn.remove(e),r.Kn.delete(s.target)}),go.apply(this,arguments)}function ws(n,e,t){const r=T(n);let s=N.min(),i=M();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,h){const l=T(a),d=l.Kn.get(h);return void 0!==d?y.resolve(l.qn.get(d)):l.He.getTargetData(u,h)}(r,o,Re(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Un.getDocumentsMatchingQuery(o,e,t?s:N.min(),t?i:M())).next(a=>({documents:a,zn:i})))}function Gh(n,e){const t=T(n),r=T(t.He),s=t.qn.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.Et(i,e).next(o=>o?o.target:null))}function zh(n){const e=T(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(r,s,i){const o=T(r);let a=Le(),u=so(i);const h=ht(s),l=IDBKeyRange.lowerBound(u,!0);return h.jt({index:Z.readTimeIndex,range:l},(d,m)=>{const p=ro(o.k,m);a=a.insert(p.key,p),u=m.readTime}).next(()=>({In:a,readTime:Ah(u)}))}(e.Qn,t,e.jn)).then(({In:t,readTime:r})=>(e.jn=r,t))}function po(){return po=(0,g.Z)(function*(n){const e=T(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(r){const s=ht(r);let i=N.min();return s.jt({index:Z.readTimeIndex,reverse:!0},(o,a,u)=>{a.readTime&&(i=Ah(a.readTime)),u.done()}).next(()=>i)}(t)).then(t=>{e.jn=t})}),po.apply(this,arguments)}function yo(){return yo=(0,g.Z)(function*(n,e,t,r){const s=T(n);let i=M(),o=Le(),a=Xc();for(const l of t){const d=e.Hn(l.metadata.name);l.document&&(i=i.add(d)),o=o.insert(d,e.Jn(l)),a=a.insert(d,e.Yn(l.metadata.readTime))}const u=s.Qn.newChangeBuffer({trackRemovals:!0}),h=yield mn(s,(l=r,Re(Xt(F.fromString(`__bundle__/docs/${l}`)))));var l;return s.persistence.runTransaction("Apply bundle documents","readwrite",l=>$h(l,u,o,N.min(),a).next(d=>(u.apply(l),d)).next(d=>s.He.removeMatchingKeysForTargetId(l,h.targetId).next(()=>s.He.addMatchingKeys(l,i,h.targetId)).next(()=>s.Wn.Vn(l,d)).next(()=>d)))}),yo.apply(this,arguments)}function ag(n,e){return vo.apply(this,arguments)}function vo(){return vo=(0,g.Z)(function*(n,e,t=M()){const r=yield mn(n,Re(io(e.bundledQuery))),s=T(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=ne(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ye.saveNamedQuery(i,e);const a=r.withResumeToken(te.EMPTY_BYTE_STRING,o);return s.qn=s.qn.insert(a.targetId,a),s.He.updateTargetData(i,a).next(()=>s.He.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.He.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ye.saveNamedQuery(i,e))})}),vo.apply(this,arguments)}class ug{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return y.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var r;return this.Xn.set(t.id,{id:(r=t).id,version:r.version,createTime:ne(r.createTime)}),y.resolve()}getNamedQuery(e,t){return y.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(r=t).name,query:io(r.bundledQuery),readTime:ne(r.readTime)}),y.resolve();var r}}class wo{constructor(){this.ts=new j(re.es),this.ns=new j(re.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const r=new re(e,t);this.ts=this.ts.add(r),this.ns=this.ns.add(r)}rs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.os(new re(e,t))}cs(e,t){e.forEach(r=>this.removeReference(r,t))}us(e){const t=new E(new F([])),r=new re(t,e),s=new re(t,e+1),i=[];return this.ns.forEachInRange([r,s],o=>{this.os(o),i.push(o.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new E(new F([])),r=new re(t,e),s=new re(t,e+1);let i=M();return this.ns.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new re(e,0),r=this.ts.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class re{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return E.comparator(e.key,t.key)||k(e.fs,t.fs)}static ss(e,t){return k(e.fs,t.fs)||E.comparator(e.key,t.key)}}class cg{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new j(re.es)}checkEmpty(e){return y.resolve(0===this.An.length)}addMutationBatch(e,t,r,s){const i=this.ds;this.ds++;const o=new to(i,t,r,s);this.An.push(o);for(const a of s)this.ws=this.ws.add(new re(a.key,i)),this.Jt.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.gs(t+1),i=s<0?0:s;return y.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return y.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new re(t,0),s=new re(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([r,s],o=>{const a=this._s(o.fs);i.push(a)}),y.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);return t.forEach(s=>{const i=new re(s,0),o=new re(s,Number.POSITIVE_INFINITY);this.ws.forEachInRange([i,o],a=>{r=r.add(a.fs)})}),y.resolve(this.ys(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;E.isDocumentKey(i)||(i=i.child(""));const o=new re(new E(i),0);let a=new j(k);return this.ws.forEachWhile(u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(a=a.add(u.fs)),!0)},o),y.resolve(this.ys(a))}ys(e){const t=[];return e.forEach(r=>{const s=this._s(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){A(0===this.ps(t.batchId,"removed")),this.An.shift();let r=this.ws;return y.forEach(t.mutations,s=>{const i=new re(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ws=r})}ee(e){}containsKey(e,t){const r=new re(t,0),s=this.ws.firstAfterOrEqual(r);return y.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return y.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class hg{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new H(E.comparator),this.size=0}addEntry(e,t,r){const s=t.key,i=this.docs.get(s),o=i?i.size:0,a=this.Ts(t);return this.docs=this.docs.insert(s,{document:t.clone(),size:a,readTime:r}),this.size+=a-o,this.Jt.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.clone():V.newInvalidDocument(t))}getEntries(e,t){let r=Le();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.clone():V.newInvalidDocument(s))}),y.resolve(r)}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=new E(t.path.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u,readTime:h}}=o.getNext();if(!t.path.isPrefixOf(a.path))break;h.compareTo(r)<=0||er(t,u)&&(s=s.insert(u.key,u.clone()))}return y.resolve(s)}Es(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new lg(this)}getSize(e){return y.resolve(this.size)}}class lg extends Ph{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.document.isValidDocument()?t.push(this.De.addEntry(e,s.document,this.getReadTime(r))):this.De.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class dg{constructor(e){this.persistence=e,this.Is=new fn(t=>Yn(t),ns),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.As=0,this.Rs=new wo,this.targetCount=0,this.Ps=kt.ie()}forEachTarget(e,t){return this.Is.forEach((r,s)=>t(s)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.Ps.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.As&&(this.As=t),y.resolve()}ce(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ps=new kt(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ce(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.ce(t),y.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Is.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Is.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),y.waitFor(i).next(()=>s)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.Is.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.Rs.rs(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.Rs.cs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),y.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Rs.ls(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.Rs.containsKey(t))}}class fg{constructor(e,t){this.bs={},this.Be=new Ce(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new dg(this),this.Jt=new Km,this.Je=new hg(this.Jt,r=>this.referenceDelegate.vs(r)),this.k=new xh(t),this.Ye=new ug(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new cg(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,r){_("MemoryPersistence","Starting transaction:",e);const s=new mg(this.Be.next());return this.referenceDelegate.Vs(),r(s).next(i=>this.referenceDelegate.Ss(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ds(e,t){return y.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,t)))}}class mg extends Th{constructor(e){super(),this.currentSequenceNumber=e}}class _o{constructor(e){this.persistence=e,this.Cs=new wo,this.Ns=null}static ks(e){return new _o(e)}get xs(){if(this.Ns)return this.Ns;throw x()}addReference(e,t,r){return this.Cs.addReference(r,t),this.xs.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.Cs.removeReference(r,t),this.xs.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),y.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(s=>this.xs.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.xs.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.xs,r=>{const s=E.fromPath(r);return this.$s(e,s).next(i=>{i||t.removeEntry(s)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(r=>{r?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return y.or([()=>y.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function Qh(n,e){return`firestore_clients_${n}_${e}`}function Hh(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function To(n,e){return`firestore_targets_${n}_${e}`}class _s{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Fs(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new v(s.error.code,s.error.message))),o?new _s(e,t,s.state,i):($("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class dr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Fs(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new v(r.error.code,r.error.message))),i?new dr(e,r.state,s):($("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ts{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Fs(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=ls();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=xc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ts(e,i):($("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Io{constructor(e,t){this.clientId=e,this.onlineState=t}static Fs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Io(t.clientId,t.onlineState):($("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Eo{constructor(){this.activeTargetIds=ls()}Ms(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xo{constructor(e,t,r,s,i){this.window=e,this.Oe=t,this.persistenceKey=r,this.Bs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new H(k),this.started=!1,this.js=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Qh(this.persistenceKey,this.Bs),this.Ws=`firestore_sequence_number_${this.persistenceKey}`,this.Ks=this.Ks.insert(this.Bs,new Eo),this.Gs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Js=`firestore_online_state_${this.persistenceKey}`,this.Ys=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static bt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,g.Z)(function*(){const t=yield e.syncEngine.Tn();for(const s of t){if(s===e.Bs)continue;const i=e.getItem(Qh(e.persistenceKey,s));if(i){const o=Ts.Fs(s,i);o&&(e.Ks=e.Ks.insert(o.clientId,o))}}e.Xs();const r=e.storage.getItem(e.Js);if(r){const s=e.Zs(r);s&&e.ti(s)}for(const s of e.js)e.qs(s);e.js=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,r){this.ni(e,t,r),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(To(this.persistenceKey,e));if(r){const s=dr.Fs(e,r);s&&(t=s.state)}}return this.ii.Ms(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(To(this.persistenceKey,e))}updateQueryState(e,t,r){this.ri(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.si(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ai()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(_("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Qs)return void $("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,g.Z)(function*(){if(t.started){if(null!==r.key)if(t.Gs.test(r.key)){if(null==r.newValue){const s=t.ci(r.key);return t.ui(s,null)}{const s=t.hi(r.key,r.newValue);if(s)return t.ui(s.clientId,s)}}else if(t.zs.test(r.key)){if(null!==r.newValue){const s=t.li(r.key,r.newValue);if(s)return t.fi(s)}}else if(t.Hs.test(r.key)){if(null!==r.newValue){const s=t.di(r.key,r.newValue);if(s)return t.wi(s)}}else if(r.key===t.Js){if(null!==r.newValue){const s=t.Zs(r.newValue);if(s)return t.ti(s)}}else if(r.key===t.Ws){const s=function(i){let o=Ce.I;if(null!=i)try{const a=JSON.parse(i);A("number"==typeof a),o=a}catch(a){$("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Ce.I&&t.sequenceNumberHandler(s)}else if(r.key===t.Ys)return t.syncEngine._i()}else t.js.push(r)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Os())}ni(e,t,r){const s=new _s(this.currentUser,e,t,r),i=Hh(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Os())}si(e){const t=Hh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){this.storage.setItem(this.Js,JSON.stringify({clientId:this.Bs,onlineState:e}))}ri(e,t,r){const s=To(this.persistenceKey,e),i=new dr(e,t,r);this.setItem(s,i.Os())}ai(){this.setItem(this.Ys,"value-not-used")}ci(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const r=this.ci(e);return Ts.Fs(r,t)}li(e,t){const r=this.zs.exec(e),s=Number(r[1]);return _s.Fs(new ae(void 0!==r[2]?r[2]:null),s,t)}di(e,t){const r=this.Hs.exec(e),s=Number(r[1]);return dr.Fs(s,t)}Zs(e){return Io.Fs(e)}fi(e){var t=this;return(0,g.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.mi(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const r=t?this.Ks.insert(e,t):this.Ks.remove(e),s=this.ei(this.Ks),i=this.ei(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.yi(o,a).then(()=>{this.Ks=r})}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=ls();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Wh{constructor(){this.pi=new Eo,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}updateQueryState(e,t,r){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new Eo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class gg{Ei(e){}shutdown(){}}class Yh{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Pi(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const pg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class yg{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Fi(e){this.ki(e)}Oi(e){this.xi(e)}}class vg extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Mi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,r,s,i){const o=this.Ui(e,t);_("RestConnection","Sending: ",o,r);const a={};return this.qi(a,s,i),this.Ki(e,o,a,r).then(u=>(_("RestConnection","Received: ",u),u),u=>{throw Gn("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}ji(e,t,r,s,i){return this.Bi(e,t,r,s,i)}qi(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+zt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}Ui(e,t){return`${this.Mi}/v1/${t}:${pg[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,r,s){return new Promise((i,o)=>{const a=new Uf;a.listenOnce(Mf.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Pi.NO_ERROR:const h=a.getResponseJson();_("Connection","XHR received:",JSON.stringify(h)),i(h);break;case Pi.TIMEOUT:_("Connection",'RPC "'+e+'" timed out'),o(new v(f.DEADLINE_EXCEEDED,"Request time out"));break;case Pi.HTTP_ERROR:const l=a.getStatus();if(_("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){const d=a.getResponseJson().error;if(d&&d.status&&d.message){const m=function(p){const w=p.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(w)>=0?w:f.UNKNOWN}(d.status);o(new v(m,d.message))}else o(new v(f.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new v(f.UNAVAILABLE,"Connection failed."));break;default:x()}}finally{_("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}Qi(e,t,r){const s=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Of(),o=Ff(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new qf({})),this.qi(a.initMessageHeaders,t,r),(0,O.uI)()||(0,O.b$)()||(0,O.d)()||(0,O.w1)()||(0,O.Mn)()||(0,O.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");_("Connection","Creating WebChannel: "+u,a);const h=i.createWebChannel(u,a);let l=!1,d=!1;const m=new yg({Vi:w=>{d?_("Connection","Not sending because WebChannel is closed:",w):(l||(_("Connection","Opening WebChannel transport."),h.open(),l=!0),_("Connection","WebChannel sending:",w),h.send(w))},Si:()=>h.close()}),p=(w,S,C)=>{w.listen(S,Y=>{try{C(Y)}catch(ge){setTimeout(()=>{throw ge},0)}})};return p(h,Jr.EventType.OPEN,()=>{d||_("Connection","WebChannel transport opened.")}),p(h,Jr.EventType.CLOSE,()=>{d||(d=!0,_("Connection","WebChannel transport closed"),m.Fi())}),p(h,Jr.EventType.ERROR,w=>{d||(d=!0,Gn("Connection","WebChannel transport errored:",w),m.Fi(new v(f.UNAVAILABLE,"The operation could not be completed")))}),p(h,Jr.EventType.MESSAGE,w=>{var S;if(!d){const C=w.data[0];A(!!C);const Y=C,ge=Y.error||(null===(S=Y[0])||void 0===S?void 0:S.error);if(ge){_("Connection","WebChannel received error:",ge);const et=ge.status;let Ze=function(za){const Ps=Q[za];if(void 0!==Ps)return Yc(Ps)}(et),Ke=ge.message;void 0===Ze&&(Ze=f.INTERNAL,Ke="Unknown error status: "+et+" with message "+ge.message),d=!0,m.Fi(new v(Ze,Ke)),h.close()}else _("Connection","WebChannel received:",C),m.Oi(C)}}),p(o,Pf.STAT_EVENT,w=>{w.stat===gc.PROXY?_("Connection","Detected buffering proxy"):w.stat===gc.NOPROXY&&_("Connection","Detected no buffering proxy")}),setTimeout(()=>{m.$i()},0),m}}function Jh(){return"undefined"!=typeof window?window:null}function Is(){return"undefined"!=typeof document?document:null}function fr(n){return new Sm(n,!0)}class So{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Wi=r,this.Gi=s,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),s=Math.max(0,t-r);s>0&&_("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,s,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Xh{constructor(e,t,r,s,i,o,a,u){this.Oe=e,this.nr=r,this.sr=s,this.ir=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new So(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return(0,g.Z)(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return(0,g.Z)(function*(){if(e.lr())return e.close(0)})()}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}close(e,t){var r=this;return(0,g.Z)(function*(){r.yr(),r.pr(),r.ur.cancel(),r.rr++,4!==e?r.ur.reset():t&&t.code===f.RESOURCE_EXHAUSTED?($(t.toString()),$("Using maximum backoff delay to prevent overloading the backend."),r.ur.Xi()):t&&t.code===f.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Tr(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.rr===t&&this.Ir(r,s)},r=>{e(()=>{const s=new v(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ar(s)})})}Ir(e,t){const r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{r(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(s=>{r(()=>this.Ar(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}dr(){var e=this;this.state=5,this.ur.Zi((0,g.Z)(function*(){e.state=0,e.start()}))}Ar(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Oe.enqueueAndForget(()=>this.rr===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class wg extends Xh{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:x(),s=e.targetChange.targetIds||[],i=function(u,h){return u.C?(A(void 0===h||"string"==typeof h),te.fromBase64String(h||"")):(A(void 0===h||h instanceof Uint8Array),te.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=void 0===u.code?f.UNKNOWN:Yc(u.code);return new v(h,u.message||"")}(o);t=new th(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Ue(n,r.document.name),i=ne(r.document.updateTime),o=new de({mapValue:{fields:r.document.fields}}),a=V.newFoundDocument(s,i,o);t=new ds(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Ue(n,r.document),i=r.readTime?ne(r.readTime):N.min(),o=V.newNoDocument(s,i);t=new ds([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Ue(n,r.document);t=new ds([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return x();{const r=e.filter,i=new pm(r.count||0);t=new eh(r.targetId,i)}}var u;return t}(this.k,e),r=function(s){if(!("targetChange"in s))return N.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?N.min():i.readTime?ne(i.readTime):N.min()}(e);return this.listener.Pr(t,r)}br(e){const t={};t.database=ur(this.k),t.addTarget=function(s,i){let o;const a=i.target;return o=rs(a)?{documents:dh(s,a)}:{query:fh(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=ih(s,i.resumeToken):i.snapshotVersion.compareTo(N.min())>0&&(o.readTime=or(s,i.snapshotVersion.toTimestamp())),o}(this.k,e);const r=function(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return x()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.gr(t)}vr(e){const t={};t.database=ur(this.k),t.removeTarget=e,this.gr(t)}}class _g extends Xh{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(A(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(n,e){return n&&n.length>0?(A(void 0!==e),n.map(t=>function(r,s){let i=ne(r.updateTime?r.updateTime:s);return i.isEqual(N.min())&&(i=ne(s)),new fm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ne(e.commitTime);return this.listener.Cr(r,t)}return A(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=ur(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fs(this.k,r))};this.gr(t)}}class Tg extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=r,this.k=s,this.$r=!1}Fr(){if(this.$r)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,r){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.Bi(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(f.UNKNOWN,s.toString())})}ji(e,t,r){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.ji(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(f.UNKNOWN,s.toString())})}terminate(){this.$r=!0}}class Ig{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Or=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?($(t),this.Lr=!1):_("OnlineStateTracker",t)}jr(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}class Eg{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(a=>{r.enqueueAndForget((0,g.Z)(function*(){var u;lt(o)&&(_("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,g.Z)(function*(h){const l=T(h);l.Gr.add(4),yield pn(l),l.Jr.set("Unknown"),l.Gr.delete(4),yield mr(l)}),function(h){return u.apply(this,arguments)})(o))}))}),this.Jr=new Ig(r,s)}}function mr(n){return Ao.apply(this,arguments)}function Ao(){return Ao=(0,g.Z)(function*(n){if(lt(n))for(const e of n.zr)yield e(!0)}),Ao.apply(this,arguments)}function pn(n){return bo.apply(this,arguments)}function bo(){return bo=(0,g.Z)(function*(n){for(const e of n.zr)yield e(!1)}),bo.apply(this,arguments)}function Es(n,e){const t=T(n);t.Wr.has(e.targetId)||(t.Wr.set(e.targetId,e),No(t)?Do(t):vn(t).lr()&&Co(t,e))}function gr(n,e){const t=T(n),r=vn(t);t.Wr.delete(e),r.lr()&&el(t,e),0===t.Wr.size&&(r.lr()?r._r():lt(t)&&t.Jr.set("Unknown"))}function Co(n,e){n.Yr.X(e.targetId),vn(n).br(e)}function el(n,e){n.Yr.X(e),vn(n).vr(e)}function Do(n){n.Yr=new Im({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Wr.get(e)||null}),vn(n).start(),n.Jr.Br()}function No(n){return lt(n)&&!vn(n).hr()&&n.Wr.size>0}function lt(n){return 0===T(n).Gr.size}function tl(n){n.Yr=void 0}function xg(n){return ko.apply(this,arguments)}function ko(){return ko=(0,g.Z)(function*(n){n.Wr.forEach((e,t)=>{Co(n,e)})}),ko.apply(this,arguments)}function Sg(n,e){return Ro.apply(this,arguments)}function Ro(){return Ro=(0,g.Z)(function*(n,e){tl(n),No(n)?(n.Jr.Kr(e),Do(n)):n.Jr.set("Unknown")}),Ro.apply(this,arguments)}function Ag(n,e,t){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,g.Z)(function*(n,e,t){if(n.Jr.set("Online"),e instanceof th&&2===e.state&&e.cause)try{yield(r=(0,g.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.Wr.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.Wr.delete(a),s.Yr.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xs(n,r)}else if(e instanceof ds?n.Yr.ot(e):e instanceof eh?n.Yr.dt(e):n.Yr.ut(e),!t.isEqual(N.min()))try{const r=yield Kh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Yr.gt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const h=s.Wr.get(u);h&&s.Wr.set(u,h.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.Wr.get(a);if(!u)return;s.Wr.set(a,u.withResumeToken(te.EMPTY_BYTE_STRING,u.snapshotVersion)),el(s,a);const h=new at(u.target,a,1,u.sequenceNumber);Co(s,h)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield xs(n,r)}var r}),Lo.apply(this,arguments)}function xs(n,e,t){return Oo.apply(this,arguments)}function Oo(){return Oo=(0,g.Z)(function*(n,e,t){if(!Dt(e))throw e;n.Gr.add(1),yield pn(n),n.Jr.set("Offline"),t||(t=()=>Kh(n.localStore)),n.asyncQueue.enqueueRetryable((0,g.Z)(function*(){_("RemoteStore","Retrying IndexedDB access"),yield t(),n.Gr.delete(1),yield mr(n)}))}),Oo.apply(this,arguments)}function nl(n,e){return e().catch(t=>xs(n,t,e))}function yn(n){return Fo.apply(this,arguments)}function Fo(){return Fo=(0,g.Z)(function*(n){const e=T(n),t=dt(e);let r=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;bg(e);)try{const s=yield sg(e.localStore,r);if(null===s){0===e.Qr.length&&t._r();break}r=s.batchId,Cg(e,s)}catch(s){yield xs(e,s)}rl(e)&&sl(e)}),Fo.apply(this,arguments)}function bg(n){return lt(n)&&n.Qr.length<10}function Cg(n,e){n.Qr.push(e);const t=dt(n);t.lr()&&t.Sr&&t.Dr(e.mutations)}function rl(n){return lt(n)&&!dt(n).hr()&&n.Qr.length>0}function sl(n){dt(n).start()}function Dg(n){return Mo.apply(this,arguments)}function Mo(){return Mo=(0,g.Z)(function*(n){dt(n).kr()}),Mo.apply(this,arguments)}function Ng(n){return Po.apply(this,arguments)}function Po(){return Po=(0,g.Z)(function*(n){const e=dt(n);for(const t of n.Qr)e.Dr(t.mutations)}),Po.apply(this,arguments)}function kg(n,e,t){return qo.apply(this,arguments)}function qo(){return qo=(0,g.Z)(function*(n,e,t){const r=n.Qr.shift(),s=no.from(r,e,t);yield nl(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield yn(n)}),qo.apply(this,arguments)}function Rg(n,e){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,g.Z)(function*(n,e){var t;e&&dt(n).Sr&&(yield(t=(0,g.Z)(function*(r,s){if(Wc(i=s.code)&&i!==f.ABORTED){const o=r.Qr.shift();dt(r).wr(),yield nl(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield yn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),rl(n)&&sl(n)}),Uo.apply(this,arguments)}function Vo(n,e){return Bo.apply(this,arguments)}function Bo(){return Bo=(0,g.Z)(function*(n,e){const t=T(n);e?(t.Gr.delete(2),yield mr(t)):e||(t.Gr.add(2),yield pn(t),t.Jr.set("Unknown"))}),Bo.apply(this,arguments)}function vn(n){return n.Xr||(n.Xr=function(e,t,r){const s=T(e);return s.Fr(),new wg(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:xg.bind(null,n),Ni:Sg.bind(null,n),Pr:Ag.bind(null,n)}),n.zr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Xr.wr(),No(n)?Do(n):n.Jr.set("Unknown")):(yield n.Xr.stop(),tl(n))});return function(t){return e.apply(this,arguments)}}())),n.Xr}function dt(n){return n.Zr||(n.Zr=function(e,t,r){const s=T(e);return s.Fr(),new _g(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:Dg.bind(null,n),Ni:Rg.bind(null,n),Nr:Ng.bind(null,n),Cr:kg.bind(null,n)}),n.zr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Zr.wr(),yield yn(n)):(yield n.Zr.stop(),n.Qr.length>0&&(_("RemoteStore",`Stopping write stream with ${n.Qr.length} pending writes`),n.Qr=[]))});return function(t){return e.apply(this,arguments)}}())),n.Zr}class jo{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new X,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new jo(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(f.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wn(n,e){if($("AsyncQueue",`${e}: ${n}`),Dt(n))return new v(f.UNAVAILABLE,`${e}: ${n}`);throw n}class _n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||E.comparator(t.key,r.key):(t,r)=>E.comparator(t.key,r.key),this.keyedMap=Yi(),this.sortedSet=new H(this.comparator)}static emptySet(e){return new _n(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _n)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new _n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class il{constructor(){this.eo=new H(E.comparator)}track(e){const t=e.doc.key,r=this.eo.get(t);r?0!==e.type&&3===r.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==r.type?this.eo=this.eo.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.eo=this.eo.remove(t):1===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):x():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,r)=>{e.push(r)}),e}}class Tn{constructor(e,t,r,s,i,o,a,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new Tn(e,t,_n.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Lg{constructor(){this.so=void 0,this.listeners=[]}}class Og{constructor(){this.queries=new fn(e=>Fc(e),Xn),this.onlineState="Unknown",this.io=new Set}}function Zo(n,e){return Ko.apply(this,arguments)}function Ko(){return Ko=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Lg),s)try{i.so=yield t.onListen(r)}catch(o){const a=wn(o,`Initialization of query '${Qi(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.ro(t.onlineState),i.so&&e.oo(i.so)&&zo(t)}),Ko.apply(this,arguments)}function $o(n,e){return Go.apply(this,arguments)}function Go(){return Go=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),Go.apply(this,arguments)}function Fg(n,e){const t=T(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.oo(s)&&(r=!0);o.so=s}}r&&zo(t)}function Mg(n,e,t){const r=T(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function zo(n){n.io.forEach(e=>{e.next()})}class Qo{constructor(e,t,r){this.query=e,this.ao=t,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}oo(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.co?this.ho(e)&&(this.ao.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.ao.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}class Pg{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class ol{constructor(e){this.k=e}Hn(e){return Ue(this.k,e)}Jn(e){return e.metadata.exists?hh(this.k,e.document,!1):V.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return ne(e)}}class qg{constructor(e,t,r){this.mo=e,this.localStore=t,this.k=r,this.queries=[],this.documents=[],this.progress=al(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,r=new ol(this.k);for(const s of e)if(s.metadata.queries){const i=r.Hn(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||M()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,g.Z)(function*(){const t=yield function(n,e,t,r){return yo.apply(this,arguments)}(e.localStore,new ol(e.k),e.documents,e.mo.id),r=e.po(e.documents);for(const s of e.queries)yield ag(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",new eg(Object.assign({},e.progress),t)})()}}function al(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class ul{constructor(e){this.key=e}}class cl{constructor(e){this.key=e}}class hl{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=M(),this.mutatedKeys=M(),this.Ao=Mc(e),this.Ro=new _n(this.Ao)}get Po(){return this.To}bo(e,t){const r=t?t.vo:new il,s=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=is(this.query)&&s.size===this.query.limit?s.last():null,h=os(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,d)=>{const m=s.get(l),p=er(this.query,d)?d:null,w=!!m&&this.mutatedKeys.has(m.key),S=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let C=!1;m&&p?m.data.isEqual(p.data)?w!==S&&(r.track({type:3,doc:p}),C=!0):this.Vo(m,p)||(r.track({type:2,doc:p}),C=!0,(u&&this.Ao(p,u)>0||h&&this.Ao(p,h)<0)&&(a=!0)):!m&&p?(r.track({type:0,doc:p}),C=!0):m&&!p&&(r.track({type:1,doc:m}),C=!0,(u||h)&&(a=!0)),C&&(p?(o=o.add(p),i=S?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),is(this.query)||os(this.query))for(;o.size>this.query.limit;){const l=is(this.query)?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Ro:o,vo:r,Bn:a,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((h,l)=>function(d,m){const p=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x()}};return p(d)-p(m)}(h.type,l.type)||this.Ao(h.doc,l.doc)),this.So(r);const o=t?this.Do():[],a=0===this.Io.size&&this.current?1:0,u=a!==this.Eo;return this.Eo=a,0!==i.length||u?{snapshot:new Tn(this.query,e.Ro,s,i,e.mutatedKeys,0===a,u,!1),Co:o}:{Co:o}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new il,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(t=>this.To=this.To.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.To=this.To.delete(t)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=M(),this.Ro.forEach(r=>{this.No(r.key)&&(this.Io=this.Io.add(r.key))});const t=[];return e.forEach(r=>{this.Io.has(r)||t.push(new cl(r))}),this.Io.forEach(r=>{e.has(r)||t.push(new ul(r))}),t}ko(e){this.To=e.zn,this.Io=M();const t=this.bo(e.documents);return this.applyChanges(t,!0)}xo(){return Tn.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Ug{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Vg{constructor(e){this.key=e,this.$o=!1}}class Bg{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Fo={},this.Oo=new fn(a=>Fc(a),Xn),this.Mo=new Map,this.Lo=new Set,this.Bo=new H(E.comparator),this.Uo=new Map,this.qo=new wo,this.Ko={},this.jo=new Map,this.Qo=kt.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function jg(n,e){return Ho.apply(this,arguments)}function Ho(){return Ho=(0,g.Z)(function*(n,e){const t=va(n);let r,s;const i=t.Oo.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{const o=yield mn(t.localStore,Re(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield Wo(t,e,r,"current"===a),t.isPrimaryClient&&Es(t.remoteStore,o)}return s}),Ho.apply(this,arguments)}function Wo(n,e,t,r){return Yo.apply(this,arguments)}function Yo(){return Yo=(0,g.Z)(function*(n,e,t,r){n.Go=(l,d,m)=>{return(p=(0,g.Z)(function*(w,S,C,Y){let ge=S.view.bo(C);ge.Bn&&(ge=yield ws(w.localStore,S.query,!1).then(({documents:Ke})=>S.view.bo(Ke,ge)));const et=Y&&Y.targetChanges.get(S.targetId),Ze=S.view.applyChanges(ge,w.isPrimaryClient,et);return aa(w,S.targetId,Ze.Co),Ze.snapshot}),function(w,S,C,Y){return p.apply(this,arguments)})(n,l,d,m);var p};const s=yield ws(n.localStore,e,!0),i=new hl(e,s.zn),o=i.bo(s.documents),a=ir.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),u=i.applyChanges(o,n.isPrimaryClient,a);aa(n,t,u.Co);const h=new Ug(e,t,i);return n.Oo.set(e,h),n.Mo.has(t)?n.Mo.get(t).push(e):n.Mo.set(t,[e]),u.snapshot}),Yo.apply(this,arguments)}function Zg(n,e){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,g.Z)(function*(n,e){const t=T(n),r=t.Oo.get(e),s=t.Mo.get(r.targetId);if(s.length>1)return t.Mo.set(r.targetId,s.filter(i=>!Xn(i,e))),void t.Oo.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield gn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),gr(t.remoteStore,r.targetId),In(t,r.targetId)}).catch(Rt))):(In(t,r.targetId),yield gn(t.localStore,r.targetId,!0))}),Jo.apply(this,arguments)}function Xo(){return Xo=(0,g.Z)(function*(n,e,t){const r=wa(n);try{const s=yield function(i,o){const a=T(i),u=ee.now(),h=o.reduce((d,m)=>d.add(m.key),M());let l;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>a.Wn.vn(d,h).next(m=>{l=m;const p=[];for(const w of o){const S=gm(w,l.get(w.key));null!=S&&p.push(new it(w.key,S,Cc(S.value.mapValue),z.exists(!0)))}return a.An.addMutationBatch(d,u,p,o)})).then(d=>(d.applyToLocalDocumentSet(l),{batchId:d.batchId,changes:l}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.Ko[i.currentUser.toKey()];u||(u=new H(k)),u=u.insert(o,a),i.Ko[i.currentUser.toKey()]=u}(r,s.batchId,t),yield Ye(r,s.changes),yield yn(r.remoteStore)}catch(s){const i=wn(s,"Failed to persist write");t.reject(i)}}),Xo.apply(this,arguments)}function ll(n,e){return ea.apply(this,arguments)}function ea(){return ea=(0,g.Z)(function*(n,e){const t=T(n);try{const r=yield rg(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Uo.get(i);o&&(A(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.$o=!0:s.modifiedDocuments.size>0?A(o.$o):s.removedDocuments.size>0&&(A(o.$o),o.$o=!1))}),yield Ye(t,r,e)}catch(r){yield Rt(r)}}),ea.apply(this,arguments)}function dl(n,e,t){const r=T(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.Oo.forEach((i,o)=>{const a=o.view.ro(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=T(i);a.onlineState=o;let u=!1;a.queries.forEach((h,l)=>{for(const d of l.listeners)d.ro(o)&&(u=!0)}),u&&zo(a)}(r.eventManager,e),s.length&&r.Fo.Pr(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $g(n,e,t){return ta.apply(this,arguments)}function ta(){return ta=(0,g.Z)(function*(n,e,t){const r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Uo.get(e),i=s&&s.key;if(i){let o=new H(E.comparator);o=o.insert(i,V.newNoDocument(i,N.min()));const a=M().add(i),u=new sr(N.min(),new Map,new j(k),o,a);yield ll(r,u),r.Bo=r.Bo.remove(i),r.Uo.delete(e),ua(r)}else yield gn(r.localStore,e,!1).then(()=>In(r,e,t)).catch(Rt)}),ta.apply(this,arguments)}function Gg(n,e){return na.apply(this,arguments)}function na(){return na=(0,g.Z)(function*(n,e){const t=T(n),r=e.batch.batchId;try{const s=yield ng(t.localStore,e);oa(t,r,null),ia(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ye(t,s)}catch(s){yield Rt(s)}}),na.apply(this,arguments)}function zg(n,e,t){return ra.apply(this,arguments)}function ra(){return ra=(0,g.Z)(function*(n,e,t){const r=T(n);try{const s=yield function(i,o){const a=T(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return a.An.lookupMutationBatch(u,o).next(l=>(A(null!==l),h=l.keys(),a.An.removeMutationBatch(u,l))).next(()=>a.An.performConsistencyCheck(u)).next(()=>a.Wn.vn(u,h))})}(r.localStore,e);oa(r,e,t),ia(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ye(r,s)}catch(s){yield Rt(s)}}),ra.apply(this,arguments)}function sa(){return sa=(0,g.Z)(function*(n,e){const t=T(n);lt(t.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=T(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.An.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.jo.get(r)||[];s.push(e),t.jo.set(r,s)}catch(r){const s=wn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),sa.apply(this,arguments)}function ia(n,e){(n.jo.get(e)||[]).forEach(t=>{t.resolve()}),n.jo.delete(e)}function oa(n,e,t){const r=T(n);let s=r.Ko[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ko[r.currentUser.toKey()]=s}}function In(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Mo.get(e))n.Oo.delete(r),t&&n.Fo.zo(r,t);n.Mo.delete(e),n.isPrimaryClient&&n.qo.us(e).forEach(r=>{n.qo.containsKey(r)||fl(n,r)})}function fl(n,e){n.Lo.delete(e.path.canonicalString());const t=n.Bo.get(e);null!==t&&(gr(n.remoteStore,t),n.Bo=n.Bo.remove(e),n.Uo.delete(t),ua(n))}function aa(n,e,t){for(const r of t)r instanceof ul?(n.qo.addReference(r.key,e),Hg(n,r)):r instanceof cl?(_("SyncEngine","Document no longer in limbo: "+r.key),n.qo.removeReference(r.key,e),n.qo.containsKey(r.key)||fl(n,r.key)):x()}function Hg(n,e){const t=e.key,r=t.path.canonicalString();n.Bo.get(t)||n.Lo.has(r)||(_("SyncEngine","New document in limbo: "+t),n.Lo.add(r),ua(n))}function ua(n){for(;n.Lo.size>0&&n.Bo.size<n.maxConcurrentLimboResolutions;){const e=n.Lo.values().next().value;n.Lo.delete(e);const t=new E(F.fromString(e)),r=n.Qo.next();n.Uo.set(r,new Vg(t)),n.Bo=n.Bo.insert(t,r),Es(n.remoteStore,new at(Re(Xt(t.path)),r,2,Ce.I))}}function Ye(n,e,t){return ca.apply(this,arguments)}function ca(){return ca=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[],o=[];var a;r.Oo.isEmpty()||(r.Oo.forEach((a,u)=>{o.push(r.Go(u,e,t).then(h=>{if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,h.fromCache?"not-current":"current"),s.push(h);const l=fo.$n(u.targetId,h);i.push(l)}}))}),yield Promise.all(o),r.Fo.Pr(s),yield(a=(0,g.Z)(function*(u,h){const l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>y.forEach(h,m=>y.forEach(m.kn,p=>l.persistence.referenceDelegate.addReference(d,m.targetId,p)).next(()=>y.forEach(m.xn,p=>l.persistence.referenceDelegate.removeReference(d,m.targetId,p)))))}catch(d){if(!Dt(d))throw d;_("LocalStore","Failed to update sequence numbers: "+d)}for(const d of h){const m=d.targetId;if(!d.fromCache){const p=l.qn.get(m),S=p.withLastLimboFreeSnapshotVersion(p.snapshotVersion);l.qn=l.qn.insert(m,S)}}}),function(u,h){return a.apply(this,arguments)})(r.localStore,i))}),ca.apply(this,arguments)}function Wg(n,e){return ha.apply(this,arguments)}function ha(){return ha=(0,g.Z)(function*(n,e){const t=T(n);if(!t.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());const r=yield Zh(t.localStore,e);t.currentUser=e,(s=t).jo.forEach(o=>{o.forEach(a=>{a.reject(new v(f.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.jo.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ye(t,r.Gn)}var s}),ha.apply(this,arguments)}function Yg(n,e){const t=T(n),r=t.Uo.get(e);if(r&&r.$o)return M().add(r.key);{let s=M();const i=t.Mo.get(e);if(!i)return s;for(const o of i){const a=t.Oo.get(o);s=s.unionWith(a.view.Po)}return s}}function Jg(n,e){return la.apply(this,arguments)}function la(){return la=(0,g.Z)(function*(n,e){const t=T(n),r=yield ws(t.localStore,e.query,!0),s=e.view.ko(r);return t.isPrimaryClient&&aa(t,e.targetId,s.Co),s}),la.apply(this,arguments)}function Xg(n){return da.apply(this,arguments)}function da(){return da=(0,g.Z)(function*(n){const e=T(n);return zh(e.localStore).then(t=>Ye(e,t))}),da.apply(this,arguments)}function ep(n,e,t,r){return fa.apply(this,arguments)}function fa(){return fa=(0,g.Z)(function*(n,e,t,r){const s=T(n),i=yield function(o,a){const u=T(o),h=T(u.An);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>h.Zt(l,a).next(d=>d?u.Wn.vn(l,d):y.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield yn(s.remoteStore):"acknowledged"===t||"rejected"===t?(oa(s,e,r||null),ia(s,e),a=e,T(T(s.localStore).An).ee(a)):x(),yield Ye(s,i)):_("SyncEngine","Cannot apply mutation batch with id: "+e)}),fa.apply(this,arguments)}function ma(){return ma=(0,g.Z)(function*(n,e){const t=T(n);if(va(t),wa(t),!0===e&&!0!==t.Wo){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield ml(t,r.toArray());t.Wo=!0,yield Vo(t.remoteStore,!0);for(const i of s)Es(t.remoteStore,i)}else if(!1===e&&!1!==t.Wo){const r=[];let s=Promise.resolve();t.Mo.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(In(t,o),gn(t.localStore,o,!0))),gr(t.remoteStore,o)}),yield s,yield ml(t,r),function(i){const o=T(i);o.Uo.forEach((a,u)=>{gr(o.remoteStore,u)}),o.qo.hs(),o.Uo=new Map,o.Bo=new H(E.comparator)}(t),t.Wo=!1,yield Vo(t.remoteStore,!1)}}),ma.apply(this,arguments)}function ml(n,e,t){return ga.apply(this,arguments)}function ga(){return ga=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[];for(const o of e){let a;const u=r.Mo.get(o);if(u&&0!==u.length){a=yield mn(r.localStore,Re(u[0]));for(const h of u){const l=r.Oo.get(h),d=yield Jg(r,l);d.snapshot&&i.push(d.snapshot)}}else{const h=yield Gh(r.localStore,o);a=yield mn(r.localStore,h),yield Wo(r,gl(h),o,!1)}s.push(a)}return r.Fo.Pr(i),s}),ga.apply(this,arguments)}function gl(n){return Lc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function np(n){const e=T(n);return T(T(e.localStore).persistence).Tn()}function rp(n,e,t,r){return pa.apply(this,arguments)}function pa(){return pa=(0,g.Z)(function*(n,e,t,r){const s=T(n);if(s.Wo)_("SyncEngine","Ignoring unexpected query state notification.");else if(s.Mo.has(e))switch(t){case"current":case"not-current":{const i=yield zh(s.localStore),o=sr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield Ye(s,i,o);break}case"rejected":yield gn(s.localStore,e,!0),In(s,e,r);break;default:x()}}),pa.apply(this,arguments)}function sp(n,e,t){return ya.apply(this,arguments)}function ya(){return ya=(0,g.Z)(function*(n,e,t){const r=va(n);if(r.Wo){for(const s of e){if(r.Mo.has(s)){_("SyncEngine","Adding an already active target "+s);continue}const i=yield Gh(r.localStore,s),o=yield mn(r.localStore,i);yield Wo(r,gl(i),o.targetId,!1),Es(r.remoteStore,o)}for(const s of t)r.Mo.has(s)&&(yield gn(r.localStore,s,!1).then(()=>{gr(r.remoteStore,s),In(r,s)}).catch(Rt))}}),ya.apply(this,arguments)}function va(n){const e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ll.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$g.bind(null,e),e.Fo.Pr=Fg.bind(null,e.eventManager),e.Fo.zo=Mg.bind(null,e.eventManager),e}function wa(n){const e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Gg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zg.bind(null,e),e}class pl{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,g.Z)(function*(){t.k=fr(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return jh(this.persistence,new Bh,e.initialUser,this.k)}Yo(e){return new fg(_o.ks,this.k)}Jo(e){return new Wh}terminate(){var e=this;return(0,g.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class yl extends pl{constructor(e,t,r){super(),this.ta=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e),yield function(n){return po.apply(this,arguments)}(r.localStore),yield r.ta.initialize(r,e),yield wa(r.ta.syncEngine),yield yn(r.ta.remoteStore),yield r.persistence.sn(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}Zo(e){return jh(this.persistence,new Bh,e.initialUser,this.k)}Xo(e){return new Qm(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Yo(e){const t=lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ae.withCacheSize(this.cacheSizeBytes):Ae.DEFAULT;return new ho(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Jh(),Is(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Wh}}class op extends yl{constructor(e,t){super(e,t,!1),this.ta=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e);const s=r.ta.syncEngine;r.sharedClientState instanceof xo&&(r.sharedClientState.syncEngine={mi:ep.bind(null,s),gi:rp.bind(null,s),yi:sp.bind(null,s),Tn:np.bind(null,s),_i:Xg.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.sn(function(){var i=(0,g.Z)(function*(o){yield function(n,e){return ma.apply(this,arguments)}(r.ta.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):o||r.gcScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Jo(e){const t=Jh();if(!xo.bt(t))throw new v(f.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new xo(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class _a{initialize(e,t){var r=this;return(0,g.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>dl(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Wg.bind(null,r.syncEngine),yield Vo(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Og}createDatastore(e){const t=fr(e.databaseInfo.databaseId),r=new vg(e.databaseInfo);return new Tg(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>dl(this.syncEngine,a,0),o=Yh.bt()?new Yh:new gg,new Eg(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,h){const l=new Bg(r,s,i,o,a,u);return h&&(l.Wo=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,g.Z)(function*(t){const r=T(t);_("RemoteStore","RemoteStore shutting down."),r.Gr.add(5),yield pn(r),r.Hr.shutdown(),r.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function vl(n,e=10240){let t=0;return{read:()=>(0,g.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,g.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Ss{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ea(this.observer.next,e)}error(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}na(){this.muted=!0}ea(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ap{constructor(e,t){this.sa=e,this.k=t,this.metadata=new X,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then(r=>{r&&r._o()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.sa.cancel()}getMetadata(){var e=this;return(0,g.Z)(function*(){return e.metadata.promise})()}Ho(){var e=this;return(0,g.Z)(function*(){return yield e.getMetadata(),e.ra()})()}ra(){var e=this;return(0,g.Z)(function*(){const t=yield e.oa();if(null===t)return null;const r=e.ia.decode(t),s=Number(r);isNaN(s)&&e.aa(`length string (${r}) is not valid number`);const i=yield e.ca(s);return new Pg(JSON.parse(i),t.length+s)})()}ua(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}oa(){var e=this;return(0,g.Z)(function*(){for(;e.ua()<0&&!(yield e.ha()););if(0===e.buffer.length)return null;const t=e.ua();t<0&&e.aa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}ca(e){var t=this;return(0,g.Z)(function*(){for(;t.buffer.length<e;)(yield t.ha())&&t.aa("Reached the end of bundle when more is expected.");const r=t.ia.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}aa(e){throw this.sa.cancel(),new Error(`Invalid bundle format: ${e}`)}ha(){var e=this;return(0,g.Z)(function*(){const t=yield e.sa.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class up{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,g.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new v(f.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,g.Z)(function*(i,o){const a=T(i),u=ur(a.k)+"/documents",h={documents:o.map(p=>ar(a.k,p))},l=yield a.ji("BatchGetDocuments",u,h),d=new Map;l.forEach(p=>{const w=function(n,e){return"found"in e?function(t,r){A(!!r.found);const s=Ue(t,r.found.name),i=ne(r.found.updateTime),o=new de({mapValue:{fields:r.found.fields}});return V.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){A(!!r.missing),A(!!r.readTime);const s=Ue(t,r.missing),i=ne(r.readTime);return V.newNoDocument(s,i)}(n,e):x()}(a.k,p);d.set(w.key.toString(),w)});const m=[];return o.forEach(p=>{const w=d.get(p.toString());A(!!w),m.push(w)}),m}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new rr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,g.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=E.fromPath(s);e.mutations.push(new Wi(i,e.precondition(i)))}),yield(r=(0,g.Z)(function*(s,i){const o=T(s),a=ur(o.k)+"/documents",u={writes:i.map(h=>fs(o.k,h))};yield o.Bi("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw x();t=N.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(f.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?z.updateTime(t):z.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new v(f.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return z.updateTime(t)}return z.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class cp{constructor(e,t,r,s){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=s,this.la=5,this.ur=new So(this.asyncQueue,"transaction_retry")}run(){this.la-=1,this.fa()}fa(){var e=this;this.ur.Zi((0,g.Z)(function*(){const t=new up(e.datastore),r=e.da(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.wa(i)}))}).catch(s=>{e.wa(s)})}))}da(e){try{const t=this.updateFunction(e);return!xt(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}wa(e){this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget(()=>(this.fa(),Promise.resolve()))):this.deferred.reject(e)}_a(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Wc(t)}return!1}}class hp{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ae.UNAUTHENTICATED,this.clientId=wc.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,g.Z)(function*(a){_("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,()=>Promise.resolve())}getConfiguration(){var e=this;return(0,g.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new X;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=wn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function wl(n,e){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,g.Z)(function*(i){r.isEqual(i)||(yield Zh(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ta.apply(this,arguments)}function _l(n,e){return Ia.apply(this,arguments)}function Ia(){return Ia=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Ea(n);_("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>{return(i=(0,g.Z)(function*(o,a){const u=T(o);u.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const h=lt(u);u.Gr.add(3),yield pn(u),h&&u.Jr.set("Unknown"),yield u.remoteSyncer.handleCredentialChange(a),u.Gr.delete(3),yield mr(u)}),function(o,a){return i.apply(this,arguments)})(e.remoteStore,s);var i}),n.onlineComponents=e}),Ia.apply(this,arguments)}function Ea(n){return xa.apply(this,arguments)}function xa(){return xa=(0,g.Z)(function*(n){return n.offlineComponents||(_("FirestoreClient","Using default OfflineComponentProvider"),yield wl(n,new pl)),n.offlineComponents}),xa.apply(this,arguments)}function As(n){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,g.Z)(function*(n){return n.onlineComponents||(_("FirestoreClient","Using default OnlineComponentProvider"),yield _l(n,new _a)),n.onlineComponents}),Sa.apply(this,arguments)}function Tl(n){return Ea(n).then(e=>e.persistence)}function Aa(n){return Ea(n).then(e=>e.localStore)}function Il(n){return As(n).then(e=>e.remoteStore)}function ba(n){return As(n).then(e=>e.syncEngine)}function En(n){return Ca.apply(this,arguments)}function Ca(){return Ca=(0,g.Z)(function*(n){const e=yield As(n),t=e.eventManager;return t.onListen=jg.bind(null,e.syncEngine),t.onUnlisten=Zg.bind(null,e.syncEngine),t}),Ca.apply(this,arguments)}function El(n,e,t={}){const r=new X;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,u){const h=new Ss({next:d=>{i.enqueueAndForget(()=>$o(s,l));const m=d.docs.has(o);!m&&d.fromCache?u.reject(new v(f.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&a&&"server"===a.source?u.reject(new v(f.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),l=new Qo(Xt(o.path),h,{includeMetadataChanges:!0,wo:!0});return Zo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}function xl(n,e,t={}){const r=new X;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,u){const h=new Ss({next:d=>{i.enqueueAndForget(()=>$o(s,l)),d.fromCache&&"server"===a.source?u.reject(new v(f.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),l=new Qo(o,h,{includeMetadataChanges:!0,wo:!0});return Zo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}class wp{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class xn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xn&&e.projectId===this.projectId&&e.database===this.database}}const Sl=new Map;function Da(n,e,t){if(!t)throw new v(f.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Al(n,e,t,r){if(!0===e&&!0===r)throw new v(f.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bl(n){if(!E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Cl(n){if(E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bs(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":x()}function L(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bs(n);throw new v(f.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Dl(n,e){if(e<=0)throw new v(f.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Nl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new v(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Al("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pr{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nl({}),this._settingsFrozen=!1,e instanceof xn?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new v(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(s.options.projectId)}(e))}get app(){if(!this._app)throw new v(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nl(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new jf;switch(t.type){case"gapi":const r=t.client;return A(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Gf(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new v(f.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sl.get(e);t&&(_("ComponentProvider","Removing Datastore"),Sl.delete(e),t.terminate())}(this),Promise.resolve()}}class q{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Be(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new q(this.firestore,e,this._key)}}class me{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new me(this.firestore,e,this._query)}}class Be extends me{constructor(e,t,r){super(e,t,Xt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new q(this.firestore,null,new E(e))}withConverter(e){return new Be(this.firestore,e,this._path)}}function kl(n,e,...t){if(n=(0,O.m9)(n),Da("collection","path",e),n instanceof pr){const r=F.fromString(e,...t);return Cl(r),new Be(n,null,r)}{if(!(n instanceof q||n instanceof Be))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return Cl(r),new Be(n.firestore,null,r)}}function Cs(n,e,...t){if(n=(0,O.m9)(n),1===arguments.length&&(e=wc.A()),Da("doc","path",e),n instanceof pr){const r=F.fromString(e,...t);return bl(r),new q(n,null,new E(r))}{if(!(n instanceof q||n instanceof Be))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return bl(r),new q(n.firestore,n instanceof Be?n.converter:null,new E(r))}}function Rl(n,e){return n=(0,O.m9)(n),e=(0,O.m9)(e),(n instanceof q||n instanceof Be)&&(e instanceof q||e instanceof Be)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ll(n,e){return n=(0,O.m9)(n),e=(0,O.m9)(e),n instanceof me&&e instanceof me&&n.firestore===e.firestore&&Xn(n._query,e._query)&&n.converter===e.converter}class Ip{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new So(this,"async_queue_retry"),this.Ra=()=>{const t=Is();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const e=Is();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pa(),this.ba(e)}enterRestrictedMode(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;const t=Is();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}enqueue(e){if(this.Pa(),this.ya)return new Promise(()=>{});const t=new X;return this.ba(()=>this.ya&&this.Ia?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ga.push(e),this.va()))}va(){var e=this;return(0,g.Z)(function*(){if(0!==e.ga.length){try{yield e.ga[0](),e.ga.shift(),e.ur.reset()}catch(t){if(!Dt(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}e.ga.length>0&&e.ur.Zi(()=>e.va())}})()}ba(e){const t=this.ma.then(()=>(this.Ea=!0,e().catch(r=>{throw this.Ta=r,this.Ea=!1,$("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Ea=!1,r))));return this.ma=t,t}enqueueAfterDelay(e,t,r){this.Pa(),this.Aa.indexOf(e)>-1&&(t=0);const s=jo.createAndSchedule(this,e,t,r,i=>this.Va(i));return this.pa.push(s),s}Pa(){this.Ta&&x()}verifyOperationInProgress(){}Sa(){var e=this;return(0,g.Z)(function*(){let t;do{t=e.ma,yield t}while(t!==e.ma)})()}Da(e){for(const t of this.pa)if(t.timerId===e)return!0;return!1}Ca(e){return this.Sa().then(()=>{this.pa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.pa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Sa()})}Na(e){this.Aa.push(e)}Va(e){const t=this.pa.indexOf(e);this.pa.splice(t,1)}}function Na(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class Ep{constructor(){this._progressObserver={},this._taskCompletionResolver=new X,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class B extends pr{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new Ip,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Ol(this),this._firestoreClient.terminate()}}function W(n){return n._firestoreClient||Ol(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Ol(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new wp(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new hp(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Fl(n,e,t){const r=new X;return n.asyncQueue.enqueue((0,g.Z)(function*(){try{yield wl(n,t),yield _l(n,e),r.resolve()}catch(s){if(!("FirebaseError"===(i=s).name?i.code===f.FAILED_PRECONDITION||i.code===f.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw s;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var i})).then(()=>r.promise)}function Ml(n){if(n._initialized||n._terminated)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Je{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(f.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class je{constructor(e){this._byteString=e}static fromBase64String(e){try{return new je(te.fromBase64String(e))}catch(t){throw new v(f.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new je(te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Lt{constructor(e){this._methodName=e}}class Ds{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(f.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(f.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const Lp=/^__.*__$/;class Op{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new it(e,this.data,this.fieldMask,t,this.fieldTransforms):new nr(e,this.data,t,this.fieldTransforms)}}class Pl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new it(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ql(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x()}}class Ns{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.k=r,this.ignoreUndefinedProperties=s,void 0===i&&this.ka(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(e){return new Ns(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$a({path:r,Oa:!1});return s.Ma(e),s}La(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$a({path:r,Oa:!1});return s.ka(),s}Ba(e){return this.$a({path:void 0,Oa:!0})}Ua(e){return Rs(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ka(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}Ma(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(ql(this.xa)&&Lp.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}class Fp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=r||fr(e)}ja(e,t,r,s=!1){return new Ns({xa:e,methodName:t,Ka:r,path:ue.emptyPath(),Oa:!1,qa:s},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function Ot(n){const e=n._freezeSettings(),t=fr(n._databaseId);return new Fp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ks(n,e,t,r,s,i={}){const o=n.ja(i.merge||i.mergeFields?2:0,e,t,s);Oa("Data must be an object, but it was:",o,r);const a=Bl(r,o);let u,h;if(i.merge)u=new Ht(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const d of i.mergeFields){const m=Fa(e,d,t);if(!o.contains(m))throw new v(f.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Zl(l,m)||l.push(m)}u=new Ht(l),h=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,h=o.fieldTransforms;return new Op(new de(a),u,h)}class yr extends Lt{_toFieldTransform(e){if(2!==e.xa)throw e.Ua(1===e.xa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yr}}function Ul(n,e,t){return new Ns({xa:3,Ka:e.settings.Ka,methodName:n._methodName,Oa:t},e.databaseId,e.k,e.ignoreUndefinedProperties)}class ka extends Lt{_toFieldTransform(e){return new tr(e.path,new tn)}isEqual(e){return e instanceof ka}}class Mp extends Lt{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Ul(this,e,!0),r=this.Qa.map(i=>Ft(i,t)),s=new At(r);return new tr(e.path,s)}isEqual(e){return this===e}}class Pp extends Lt{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Ul(this,e,!0),r=this.Qa.map(i=>Ft(i,t)),s=new bt(r);return new tr(e.path,s)}isEqual(e){return this===e}}class qp extends Lt{constructor(e,t){super(e),this.Wa=t}_toFieldTransform(e){const t=new nn(e.k,Uc(e.k,this.Wa));return new tr(e.path,t)}isEqual(e){return this===e}}function Ra(n,e,t,r){const s=n.ja(1,e,t);Oa("Data must be an object, but it was:",s,r);const i=[],o=de.empty();Et(r,(u,h)=>{const l=Ma(e,u,t);h=(0,O.m9)(h);const d=s.La(l);if(h instanceof yr)i.push(l);else{const m=Ft(h,d);null!=m&&(i.push(l),o.set(l,m))}});const a=new Ht(i);return new Pl(o,a,s.fieldTransforms)}function La(n,e,t,r,s,i){const o=n.ja(1,e,t),a=[Fa(e,r,t)],u=[s];if(i.length%2!=0)throw new v(f.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Fa(e,i[m])),u.push(i[m+1]);const h=[],l=de.empty();for(let m=a.length-1;m>=0;--m)if(!Zl(h,a[m])){const p=a[m];let w=u[m];w=(0,O.m9)(w);const S=o.La(p);if(w instanceof yr)h.push(p);else{const C=Ft(w,S);null!=C&&(h.push(p),l.set(p,C))}}const d=new Ht(h);return new Pl(l,d,o.fieldTransforms)}function Vl(n,e,t,r=!1){return Ft(t,n.ja(r?4:3,e))}function Ft(n,e){if(jl(n=(0,O.m9)(n)))return Oa("Unsupported field value:",e,n),Bl(n,e);if(n instanceof Lt)return function(t,r){if(!ql(r.xa))throw r.Ua(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Ua(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Oa&&4!==e.xa)throw e.Ua("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=Ft(o,r.Ba(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,O.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uc(r.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=ee.fromDate(t);return{timestampValue:or(r.k,s)}}if(t instanceof ee){const s=new ee(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:or(r.k,s)}}if(t instanceof Ds)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof je)return{bytesValue:ih(r.k,t._byteString)};if(t instanceof q){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.Ua(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ji(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.Ua(`Unsupported field value: ${bs(t)}`)}(n,e)}function Bl(n,e){const t={};return Ic(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Et(n,(r,s)=>{const i=Ft(s,e.Fa(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function jl(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof Ds||n instanceof je||n instanceof q||n instanceof Lt)}function Oa(n,e,t){if(!jl(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=bs(t);throw e.Ua("an object"===r?n+" a custom object":n+" "+r)}var r}function Fa(n,e,t){if((e=(0,O.m9)(e))instanceof Je)return e._internalPath;if("string"==typeof e)return Ma(n,e);throw Rs("Field path arguments must be of type string or FieldPath.",n,!1,void 0,t)}const Up=new RegExp("[~\\*/\\[\\]]");function Ma(n,e,t){if(e.search(Up)>=0)throw Rs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Je(...e.split("."))._internalPath}catch(r){throw Rs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rs(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new v(f.INVALID_ARGUMENT,a+n+u)}function Zl(n,e){return n.some(t=>t.isEqual(e))}class vr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new q(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Vp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Vp extends vr{data(){return super.data()}}function Ls(n,e){return"string"==typeof e?Ma(n,e):e instanceof Je?e._internalPath:e._delegate._internalPath}class Mt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xe extends vr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new wr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class wr extends Xe{data(e={}){return super.data(e)}}class ft{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Mt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new wr(this._firestore,this._userDataWriter,r.key,r,new Mt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(f.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new wr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Mt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new wr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Mt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),h=i.indexOf(o.doc.key)),{type:Bp(o.type),doc:a,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Bp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x()}}function Kl(n,e){return n instanceof Xe&&e instanceof Xe?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ft&&e instanceof ft&&n._firestore===e._firestore&&Ll(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function $l(n){if(os(n)&&0===n.explicitOrderBy.length)throw new v(f.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _r{}function mt(n,...e){for(const t of e)n=t._apply(n);return n}class jp extends _r{constructor(e,t,r){super(),this.Ga=e,this.za=t,this.Ha=r,this.type="where"}_apply(e){const t=Ot(e.firestore),r=function(s,i,o,a,u,h,l){let d;if(u.isKeyField()){if("array-contains"===h||"array-contains-any"===h)throw new v(f.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on FieldPath.documentId().`);if("in"===h||"not-in"===h){Yl(l,h);const p=[];for(const w of l)p.push(Wl(a,s,w));d={arrayValue:{values:p}}}else d=Wl(a,s,l)}else"in"!==h&&"not-in"!==h&&"array-contains-any"!==h||Yl(l,h),d=Vl(o,"where",l,"in"===h||"not-in"===h);const m=Te.create(u,h,d);return function(p,w){if(w.V()){const C=Gi(p);if(null!==C&&!C.isEqual(w.field))throw new v(f.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${C.toString()}' and '${w.field.toString()}'`);const Y=$i(p);null!==Y&&Jl(0,w.field,Y)}const S=function(C,Y){for(const ge of C.filters)if(Y.indexOf(ge.op)>=0)return ge.op;return null}(p,function(C){switch(C){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(w.op));if(null!==S)throw new v(f.INVALID_ARGUMENT,S===w.op?`Invalid query. You cannot use more than one '${w.op.toString()}' filter.`:`Invalid query. You cannot use '${w.op.toString()}' filters with '${S.toString()}' filters.`)}(s,m),m}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new me(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new Qe(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class Kp extends _r{constructor(e,t){super(),this.Ga=e,this.Ja=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Jt(s,i);return function(a,u){if(null===$i(a)){const h=Gi(a);null!==h&&Jl(0,h,u.field)}}(r,o),o}(e._query,this.Ga,this.Ja);return new me(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new Qe(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Gl extends _r{constructor(e,t,r){super(),this.type=e,this.Ya=t,this.Xa=r}_apply(e){return new me(e.firestore,e.converter,Oc(e._query,this.Ya,this.Xa))}}class zl extends _r{constructor(e,t,r){super(),this.type=e,this.Za=t,this.tc=r}_apply(e){const t=Hl(e,this.type,this.Za,this.tc);return new me(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class Ql extends _r{constructor(e,t,r){super(),this.type=e,this.Za=t,this.tc=r}_apply(e){const t=Hl(e,this.type,this.Za,this.tc);return new me(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function Hl(n,e,t,r){if(t[0]=(0,O.m9)(t[0]),t[0]instanceof vr)return function(s,i,o,a,u){if(!a)throw new v(f.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const h=[];for(const l of en(s))if(l.field.isKeyField())h.push(es(i,a.key));else{const d=a.data.field(l.field);if(Vi(d))throw new v(f.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const m=l.field.canonicalString();throw new v(f.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}h.push(d)}return new Jn(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ot(n.firestore);return function(i,o,a,u,h,l){const d=i.explicitOrderBy;if(h.length>d.length)throw new v(f.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let p=0;p<h.length;p++){const w=h[p];if(d[p].field.isKeyField()){if("string"!=typeof w)throw new v(f.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof w}`);if(!zi(i)&&-1!==w.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${u}() must be a plain document ID, but '${w}' contains a slash.`);const S=i.path.child(F.fromString(w));if(!E.isDocumentKey(S))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${u}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const C=new E(S);m.push(es(o,C))}else{const S=Vl(a,u,w);m.push(S)}}return new Jn(m,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Wl(n,e,t){if("string"==typeof(t=(0,O.m9)(t))){if(""===t)throw new v(f.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!zi(e)&&-1!==t.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(F.fromString(t));if(!E.isDocumentKey(r))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return es(n,new E(r))}if(t instanceof q)return es(n,t._key);throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${bs(t)}.`)}function Yl(n,e){if(!Array.isArray(n)||0===n.length)throw new v(f.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new v(f.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Jl(n,e,t){if(!t.isEqual(e))throw new v(f.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Pa{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return G(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw x()}}convertObject(e,t){const r={};return Et(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Ds(G(e.latitude),G(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ec(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qn(e));default:return null}}convertTimestamp(e){const t=st(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=F.fromString(e);A(vh(r));const s=new xn(r.get(1),r.get(3)),i=new E(r.popFirst(5));return s.isEqual(t)||$(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Os(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Jp extends Pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}class Xl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ot(e)}set(e,t,r){this._verifyNotCommitted();const s=gt(e,this._firestore),i=Os(s.converter,t,r),o=ks(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,z.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=gt(e,this._firestore);let o;return o="string"==typeof(t=(0,O.m9)(t))||t instanceof Je?La(this._dataReader,"WriteBatch.update",i._key,t,r,s):Ra(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,z.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=gt(e,this._firestore);return this._mutations=this._mutations.concat(new rr(t._key,z.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(f.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function gt(n,e){if((n=(0,O.m9)(n)).firestore!==e)throw new v(f.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Pt extends Pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new je(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}function ed(n,e,t){n=L(n,q);const r=L(n.firestore,B),s=Os(n.converter,e,t);return Sn(r,[ks(Ot(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,z.none())])}function td(n,e,t,...r){n=L(n,q);const s=L(n.firestore,B),i=Ot(s);let o;return o="string"==typeof(e=(0,O.m9)(e))||e instanceof Je?La(i,"updateDoc",n._key,e,t,r):Ra(i,"updateDoc",n._key,e),Sn(s,[o.toMutation(n._key,z.exists(!0))])}function nd(n,...e){var t,r,s;n=(0,O.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Na(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Na(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(s=d.complete)||void 0===s?void 0:s.bind(d)}let u,h,l;if(n instanceof q)h=L(n.firestore,B),l=Xt(n._key.path),u={next:d=>{e[o]&&e[o](qa(h,n,d))},error:e[o+1],complete:e[o+2]};else{const d=L(n,me);h=L(d.firestore,B),l=d._query;const m=new Pt(h);u={next:p=>{e[o]&&e[o](new ft(h,m,d,p))},error:e[o+1],complete:e[o+2]},$l(n._query)}return function(d,m,p,w){const S=new Ss(w),C=new Qo(m,S,p);return d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return Zo(yield En(d),C)})),()=>{S.na(),d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return $o(yield En(d),C)}))}}(W(h),l,a,u)}function Sn(n,e){return function(t,r){const s=new X;return t.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e,t){return Xo.apply(this,arguments)}(yield ba(t),r,s)})),s.promise}(W(n),e)}function qa(n,e,t){const r=t.docs.get(e._key),s=new Pt(n);return new Xe(n,s,e._key,r,new Mt(t.hasPendingWrites,t.fromCache),e.converter)}class uy extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ot(e)}get(e){const t=gt(e,this._firestore),r=new Jp(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return x();const i=s[0];if(i.isFoundDocument())return new vr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new vr(this._firestore,r,t._key,null,t.converter);throw x()})}set(e,t,r){const s=gt(e,this._firestore),i=Os(s.converter,t,r),o=ks(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=gt(e,this._firestore);let o;return o="string"==typeof(t=(0,O.m9)(t))||t instanceof Je?La(this._dataReader,"Transaction.update",i._key,t,r,s):Ra(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=gt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=gt(e,this._firestore),r=new Pt(this._firestore);return super.get(e).then(s=>new Xe(this._firestore,r,t._key,s._document,new Mt(!1,!1),t.converter))}}function Ua(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function rd(){if("undefined"==typeof Uint8Array)throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function sd(){if("undefined"==typeof atob)throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){zt=Ar.SDK_VERSION,(0,Ar._registerComponent)(new eu.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new B(s,new Kf(t.getProvider("auth-internal")),new zf(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Ar.registerVersion)(pc,"3.4.0",n),(0,Ar.registerVersion)(pc,"3.4.0","esm2017")}();class Tr{constructor(e){this._delegate=e}static fromBase64String(e){return sd(),new Tr(je.fromBase64String(e))}static fromUint8Array(e){return rd(),new Tr(je.fromUint8Array(e))}toBase64(){return sd(),this._delegate.toBase64()}toUint8Array(){return rd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Va(n){return function(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of["next","error","complete"])if(r in t&&"function"==typeof t[r])return!0;return!1}(n)}class vy{enableIndexedDbPersistence(e,t){return function(n,e){Ml(n=L(n,B));const t=W(n),r=n._freezeSettings(),s=new _a;return Fl(t,s,new yl(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(n){Ml(n=L(n,B));const e=W(n),t=n._freezeSettings(),r=new _a;return Fl(e,r,new op(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(n){if(n._initialized&&!n._terminated)throw new v(f.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new X;return n._queue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{yield(t=(0,g.Z)(function*(r){if(!Me.bt())return Promise.resolve();const s=r+"main";yield Me.delete(s)}),function(r){return t.apply(this,arguments)})(lo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class id{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof xn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Gn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function(n,e,t,r={}){var s;const i=(n=L(n,pr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Gn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ae.MOCK_USER;else{o=(0,O.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new v(f.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ae(u)}n._authCredentials=new Zf(new yc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield Tl(n),t=yield Il(n);return e.setNetworkEnabled(!0),function(r){const s=T(r);return s.Gr.delete(0),mr(s)}(t)}))}(W(n=L(n,B)))}(this._delegate)}disableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield Tl(n),t=yield Il(n);return e.setNetworkEnabled(!1),(r=(0,g.Z)(function*(s){const i=T(s);i.Gr.add(0),yield pn(i),i.Jr.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(W(n=L(n,B)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Al("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(n){return function(e){const t=new X;return e.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e){return sa.apply(this,arguments)}(yield ba(e),t)})),t.promise}(W(n=L(n,B)))}(this._delegate)}onSnapshotsInSync(e){return function(n,e){return function(n,e){const t=new Ss(e);return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield En(n),s=t,T(r).io.add(s),void s.next();var r,s})),()=>{t.na(),n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield En(n),s=t,void T(r).io.delete(s);var r,s}))}}(W(n=L(n,B)),Na(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new An(this,kl(this._delegate,e))}catch(t){throw Ie(t,"collection()","Firestore.collection()")}}doc(e){try{return new Oe(this,Cs(this._delegate,e))}catch(t){throw Ie(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ee(this,function(n,e){if(n=L(n,pr),Da("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new me(n,null,(t=e,new Qe(F.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Ie(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(n,e){return function(n,e){const t=new X;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){const r=yield(s=n,As(s).then(i=>i.datastore));var s;new cp(n.asyncQueue,r,e,t).run()})),t.promise}(W(n=L(n,B)),t=>e(new uy(n,t)))}(this._delegate,t=>e(new od(this,t)))}batch(){return W(this._delegate),new ad(new Xl(this._delegate,e=>Sn(this._delegate,e)))}loadBundle(e){return function(n,e){const t=W(n=L(n,B)),r=new Ep;return function(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,h){if(u instanceof Uint8Array)return vl(u,h);if(u instanceof ArrayBuffer)return vl(new Uint8Array(u),h);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new ap(u,o);var u}(t,fr(e));n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){!function(n,e,t){const r=T(n);var s;(s=(0,g.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(m,p){const w=T(m),S=ne(p.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",C=>w.Ye.getBundleMetadata(C,p.id)).then(C=>!!C&&C.createTime.compareTo(S)>=0)}(i.localStore,u))return yield o.close(),void a._completeWith((m=u,{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}));a._updateProgress(al(u));const h=new qg(u,i.localStore,o.k);let l=yield o.Ho();for(;l;){const m=yield h.yo(l);m&&a._updateProgress(m),l=yield o.Ho()}const d=yield h.complete();yield Ye(i,d.In,void 0),yield function(m,p){const w=T(m);return w.persistence.runTransaction("Save bundle","readwrite",S=>w.Ye.saveBundleMetadata(S,p))}(i.localStore,u),a._completeWith(d.progress)}catch(u){Gn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u)}var m}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(yield ba(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function(n,e){return function(n,e){return n.asyncQueue.enqueue((0,g.Z)(function*(){return function(t,r){const s=T(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ye.getNamedQuery(i,r))}(yield Aa(n),e)}))}(W(n=L(n,B)),e).then(t=>t?new me(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Ee(this,t):null)}}class Fs extends Pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tr(new je(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Oe.forKey(t,this.firestore,null)}}class od{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Fs(e)}get(e){const t=Ut(e);return this._delegate.get(t).then(r=>new Ir(this._firestore,new Xe(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Ut(e);return r?(Ua("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}}class ad{constructor(e){this._delegate=e}set(e,t,r){const s=Ut(e);return r?(Ua("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class qt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new wr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Er(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=qt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new qt(e,new Fs(e),t),s.set(t,i)),i}}qt.INSTANCES=new WeakMap;class Oe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fs(e)}static forPath(e,t,r){if(e.length%2!=0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Oe(t,new q(t._delegate,r,new E(e)))}static forKey(e,t,r){return new Oe(t,new q(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new An(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new An(this.firestore,kl(this._delegate,e))}catch(t){throw Ie(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,O.m9)(e))instanceof q&&Rl(this._delegate,e)}set(e,t){t=Ua("DocumentReference.set",t);try{return t?ed(this._delegate,e,t):ed(this._delegate,e)}catch(r){throw Ie(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?td(this._delegate,e):td(this._delegate,e,t,...r)}catch(s){throw Ie(s,"updateDoc()","DocumentReference.update()")}}delete(){return function(n){return Sn(L(n.firestore,B),[new rr(n._key,z.none())])}(this._delegate)}onSnapshot(...e){const t=ud(e),r=cd(e,s=>new Ir(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return nd(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,q);const e=L(n.firestore,B),t=W(e),r=new Pt(e);return function(n,e){const t=new X;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield function(u,h){const l=T(u);return l.persistence.runTransaction("read document","readonly",d=>l.Wn.Rn(d,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(f.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=wn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Aa(n),e,t);var r})),t.promise}(t,n._key).then(s=>new Xe(e,r,n._key,s,new Mt(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,q);const e=L(n.firestore,B);return El(W(e),n._key,{source:"server"}).then(t=>qa(e,n,t))}(this._delegate):function(n){n=L(n,q);const e=L(n.firestore,B);return El(W(e),n._key).then(t=>qa(e,n,t))}(this._delegate),t.then(r=>new Ir(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Oe(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}function Ie(n,e,t){return n.message=n.message.replace(e,t),n}function ud(n){for(const e of n)if("object"==typeof e&&!Va(e))return e;return{}}function cd(n,e){var t,r;let s;return s=Va(n[0])?n[0]:Va(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Ir{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Oe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Kl(this._delegate,e._delegate)}}class Er extends Ir{data(e){const t=this._delegate.data(e);return function(n,e){n||x()}(void 0!==t),t}}class Ee{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fs(e)}where(e,t,r){try{return new Ee(this.firestore,mt(this._delegate,function(n,e,t){const r=e,s=Ls("where",n);return new jp(s,r,t)}(e,t,r)))}catch(s){throw Ie(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ee(this.firestore,mt(this._delegate,function(n,e="asc"){const t=e,r=Ls("orderBy",n);return new Kp(r,t)}(e,t)))}catch(r){throw Ie(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ee(this.firestore,mt(this._delegate,function(n){return Dl("limit",n),new Gl("limit",n,"F")}(e)))}catch(t){throw Ie(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ee(this.firestore,mt(this._delegate,function(n){return Dl("limitToLast",n),new Gl("limitToLast",n,"L")}(e)))}catch(t){throw Ie(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ee(this.firestore,mt(this._delegate,function(...n){return new zl("startAt",n,!0)}(...e)))}catch(t){throw Ie(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ee(this.firestore,mt(this._delegate,function(...n){return new zl("startAfter",n,!1)}(...e)))}catch(t){throw Ie(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ee(this.firestore,mt(this._delegate,function(...n){return new Ql("endBefore",n,!0)}(...e)))}catch(t){throw Ie(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ee(this.firestore,mt(this._delegate,function(...n){return new Ql("endAt",n,!1)}(...e)))}catch(t){throw Ie(t,"endAt()","Query.endAt()")}}isEqual(e){return Ll(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,me);const e=L(n.firestore,B),t=W(e),r=new Pt(e);return function(n,e){const t=new X;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield ws(s,i,!0),u=new hl(i,a.zn),h=u.bo(a.documents),l=u.applyChanges(h,!1);o.resolve(l.snapshot)}catch(a){const u=wn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Aa(n),e,t);var r})),t.promise}(t,n._query).then(s=>new ft(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,me);const e=L(n.firestore,B),t=W(e),r=new Pt(e);return xl(t,n._query,{source:"server"}).then(s=>new ft(e,r,n,s))}(this._delegate):function(n){n=L(n,me);const e=L(n.firestore,B),t=W(e),r=new Pt(e);return $l(n._query),xl(t,n._query).then(s=>new ft(e,r,n,s))}(this._delegate),t.then(r=>new Ba(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=ud(e),r=cd(e,s=>new Ba(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return nd(this._delegate,t,r)}withConverter(e){return new Ee(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}class _y{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Er(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Ba{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ee(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Er(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new _y(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Er(this._firestore,r))})}isEqual(e){return Kl(this._delegate,e._delegate)}}class An extends Ee{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Oe(this.firestore,e):null}doc(e){try{return new Oe(this.firestore,void 0===e?Cs(this._delegate):Cs(this._delegate,e))}catch(t){throw Ie(t,"doc()","CollectionReference.doc()")}}add(e){return function(n,e){const t=L(n.firestore,B),r=Cs(n),s=Os(n.converter,e);return Sn(t,[ks(Ot(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,z.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Oe(this.firestore,t))}isEqual(e){return Rl(this._delegate,e._delegate)}withConverter(e){return new An(this.firestore,this._delegate.withConverter(e?qt.getInstance(this.firestore,e):null))}}function Ut(n){return L(n,q)}class ja{constructor(...e){this._delegate=new Je(...e)}static documentId(){return new ja(ue.keyField().canonicalString())}isEqual(e){return(e=(0,O.m9)(e))instanceof Je&&this._delegate._internalPath.isEqual(e._internalPath)}}class Vt{constructor(e){this._delegate=e}static serverTimestamp(){const e=new ka("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Vt(e)}static delete(){const e=new yr("deleteField");return e._methodName="FieldValue.delete",new Vt(e)}static arrayUnion(...e){const t=function(...n){return new Mp("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Vt(t)}static arrayRemove(...e){const t=function(...n){return new Pp("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Vt(t)}static increment(e){const t=function(n){return new qp("increment",n)}(e);return t._methodName="FieldValue.increment",new Vt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Ty={Firestore:id,GeoPoint:Ds,Timestamp:ee,Blob:Tr,Transaction:od,WriteBatch:ad,DocumentReference:Oe,DocumentSnapshot:Ir,Query:Ee,QueryDocumentSnapshot:Er,QuerySnapshot:Ba,CollectionReference:An,FieldPath:ja,FieldValue:Vt,setLogLevel:function(n){!function(n){rt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function(n){(function(n,e){n.INTERNAL.registerComponent(new eu.wA("firestore-compat",t=>((e,t)=>new id(e,t,new vy))(t.getProvider("app-compat").getImmediate(),t.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},Ty)))})(n),n.registerVersion("@firebase/firestore-compat","0.1.9")}(kd.Z);var pt=D(3478),xy=D(7278);function hd(n,e){return function(n,e=Ad.z){return new bd.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function Za(n,e){return hd(n,e).pipe((0,ye.U)(t=>({payload:t,type:"query"})))}function Ms(n,e){return Za(n,e).pipe((0,Zs.O)(void 0),Ks(),(0,ye.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),h=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&h&&JSON.stringify(h.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function ld(n,e,t){return Ms(n,t).pipe((0,$s.R)((r,s)=>function(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ka(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Ka(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ka(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),function(n,e=Cd.y){return n=null!=n?n:Nd,(0,qs.e)((t,r)=>{let s,i=!0;t.subscribe(new Us.Q(r,o=>{const a=e(o);(i||!n(s,a))&&(i=!1,s=a,r.next(o))}))})}(),(0,ye.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Ka(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function dd(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}D(7892);class fd{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ms(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ye.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,Zs.O)(void 0),Ks(),(0,Gs.h)(([r,s])=>s.length>0||!r),(0,ye.U)(([r,s])=>s),ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,$s.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=dd(e);return ld(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return Za(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),ke.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(ke.iC)}add(e){return this.ref.add(e)}doc(e){return new md(this.ref.doc(e),this.afs)}}class md{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=gd(r,t);return new fd(s,i,this.afs)}snapshotChanges(){return function(n,e){return hd(n,e).pipe((0,Zs.O)(void 0),Ks(),(0,ye.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ye.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,bn.D)(this.ref.get(e)).pipe(ke.iC)}}class Dy{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ms(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Gs.h)(t=>t.length>0),ke.iC):Ms(this.query,this.afs.schedulers.outsideAngular).pipe(ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,$s.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=dd(e);return ld(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return Za(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),ke.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(ke.iC)}}const Ny=new c.OlP("angularfire2.enableFirestorePersistence"),ky=new c.OlP("angularfire2.firestore.persistenceSettings"),Ry=new c.OlP("angularfire2.firestore.settings"),Ly=new c.OlP("angularfire2.firestore.use-emulator");function gd(n,e=(t=>t)){return{query:e(n),ref:n}}let Oy=(()=>{class n{constructor(t,r,s,i,o,a,u,h,l,d,m,p,w,S,C,Y,ge){this.schedulers=u;const et=(0,Sr.on)(t,a,r),Ze=l;d&&(0,pt.nw)(et,a,m,w,S,C,p,Y),[this.firestore,this.persistenceEnabled$]=(0,Sr.cc)(`${et.name}.firestore`,"AngularFirestore",et.name,()=>{const Ke=a.runOutsideAngular(()=>et.firestore());if(i&&Ke.settings(i),Ze&&Ke.useEmulator(...Ze),s&&!(0,Pe.PM)(o)){const za=()=>{try{return(0,bn.D)(Ke.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(Ps){return"undefined"!=typeof console&&console.warn(Ps),(0,Xa.of)(!1)}};return[Ke,a.runOutsideAngular(za)]}return[Ke,(0,Xa.of)(!1)]},[i,Ze,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=gd(s,r),a=this.schedulers.ngZone.run(()=>i);return new fd(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Dy(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new md(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Sr.Dh),c.LFG(Sr.xv,8),c.LFG(Ny,8),c.LFG(Ry,8),c.LFG(c.Lbi),c.LFG(c.R0b),c.LFG(ke.HU),c.LFG(ky,8),c.LFG(Ly,8),c.LFG(pt.zQ,8),c.LFG(pt.Qv,8),c.LFG(pt.L6,8),c.LFG(pt._Q,8),c.LFG(pt.rT,8),c.LFG(pt.lh,8),c.LFG(pt.f7,8),c.LFG(xy.nm,8))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var pd=D(6636);let $a=(()=>{class n{constructor(t,r){this.store=t,this.auth=r}addArt(t){return(0,bn.D)(this.store.collection("content").add(t))}getArts(){return this.store.collection("content",t=>t.where("uid","==",this.auth.userId)).get().pipe((0,ye.U)(t=>t.docs.map(r=>Object.assign(Object.assign({},r.data()),{id:r.id}))))}getArt(t){return this.store.collection("content",r=>r.where("uid","==",this.auth.userId)).doc(t).get().pipe((0,ye.U)(r=>r.data()))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(Oy),c.LFG(pd.e))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),yd=(()=>{class n{constructor(){this.eventBus$=new Ha.x}emit(t,r){this.eventBus$.next({key:t,data:r})}on(t){return this.eventBus$.asObservable().pipe((0,Gs.h)(r=>r.key===t),(0,ye.U)(r=>r.data))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ga=(()=>{class n{constructor(t,r,s,i,o){this.museumApiService=t,this.loadingService=r,this.storage=s,this.fireApiService=i,this.eventBus=o}get lastThreeSearches(){return this.storage.lastThreeSearches}fetchArt(t){return this.loadingService.start(),this.museumApiService.getArt(t).pipe((0,Ya.w)(r=>this.museumApiService.getList(r.objectIDs[0]))).pipe((0,ye.U)(r=>({title:r.title,imageUrl:r.primaryImageSmall,artist:r.artistAlphaSort,artistBio:r.artistDisplayBio,credits:r.creditLine,objectID:r.objectID})),(0,Vs.x)(()=>{this.loadingService.stop(),this.eventBus.emit(Wa)}))}addToLastSearches(t){this.storage.addToLastSearches(t)}restoreState(){this.storage.restoreState()}submit(t){this.fireApiService.addArt(t).subscribe(r=>console.log(r))}}return n.\u0275fac=function(t){return new(t||n)(c.LFG(xr),c.LFG(js.j),c.LFG(Ja),c.LFG($a),c.LFG(yd))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Fy=(()=>{class n{constructor(t){this.el=t,this.length=0}checkLength(){this.el.nativeElement.style.color=this.length<=10&&this.length>0?"#dc3545":"white"}}return n.\u0275fac=function(t){return new(t||n)(c.Y36(c.SBq))},n.\u0275dir=c.lG2({type:n,selectors:[["","appCharacter",""]],hostBindings:function(t,r){1&t&&c.NdJ("keyup",function(){return r.checkLength()},!1,c.Jf7)},inputs:{length:"length"}}),n})();var vd=D(7533);function My(n,e){1&n&&(c.TgZ(0,"div",14),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&n&&(c.xp6(1),c.hij(" ",c.lcZ(2,1,"errors.ENTER_ART_NAME")," "))}function Py(n,e){if(1&n){const t=c.EpF();c.TgZ(0,"span",15),c.NdJ("click",function(){const i=c.CHM(t).$implicit;return c.oxw().fetchArt(i)}),c._uU(1),c.qZA()}if(2&n){const t=e.$implicit;c.xp6(1),c.Oqu(t)}}function qy(n,e){if(1&n&&(c.TgZ(0,"span",33),c._UZ(1,"input",34),c.qZA()),2&n){const t=e.$implicit;c.xp6(1),c.Q6J("value",t)}}function Uy(n,e){1&n&&(c.TgZ(0,"div",14),c._uU(1," \u10d2\u10d0\u10dc\u10ee\u10d8\u10da\u10d5\u10d0 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),c.qZA())}function Vy(n,e){1&n&&(c.TgZ(0,"div",14),c._uU(1," \u10d2\u10d0\u10dc\u10ee\u10d8\u10da\u10d5\u10d0 \u10e3\u10dc\u10d3\u10d0 \u10d8\u10e7\u10dd\u10e1 \u10db\u10d8\u10dc\u10d8\u10db\u10e3\u10db 10 \u10e1\u10d8\u10db\u10d1\u10dd\u10da\u10dd "),c.qZA())}function By(n,e){if(1&n&&(c.ynx(0),c.YNc(1,Uy,2,0,"div",9),c.YNc(2,Vy,2,0,"div",9),c.BQk()),2&n){const t=c.oxw(3);c.xp6(1),c.Q6J("ngIf",null==t.form.controls.review||null==t.form.controls.review.errors?null:t.form.controls.review.errors.required),c.xp6(1),c.Q6J("ngIf",null==t.form.controls.review||null==t.form.controls.review.errors?null:t.form.controls.review.errors.minLength)}}function jy(n,e){if(1&n){const t=c.EpF();c.TgZ(0,"div",22),c.TgZ(1,"form",23),c.NdJ("submit",function(){c.CHM(t);const s=c.oxw().ngIf;return c.oxw().submit(s)}),c.TgZ(2,"div",24),c.TgZ(3,"label",25),c._uU(4,"Review"),c.qZA(),c.TgZ(5,"div",26),c._UZ(6,"textarea",27),c.TgZ(7,"span",28),c._uU(8),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"div",24),c.TgZ(10,"label",29),c._uU(11,"Rating"),c.qZA(),c.TgZ(12,"div",26),c.YNc(13,qy,2,1,"span",30),c.qZA(),c.qZA(),c.TgZ(14,"button",31),c._uU(15,"Add"),c.qZA(),c.YNc(16,By,3,2,"ng-container",32),c.qZA(),c.qZA()}if(2&n){const t=c.oxw(2);c.xp6(1),c.Q6J("formGroup",t.form),c.xp6(6),c.Q6J("length",null==t.form.controls.review?null:t.form.controls.review.value.length),c.xp6(1),c.hij(" ",null==t.form.controls.review?null:t.form.controls.review.value.length,""),c.xp6(5),c.Q6J("ngForOf",t.ratings),c.xp6(3),c.Q6J("ngIf",t.submitted&&t.form.invalid)}}function Zy(n,e){if(1&n&&(c.TgZ(0,"div",16),c._UZ(1,"img",17),c.TgZ(2,"div",18),c.TgZ(3,"h5",19),c._uU(4),c.qZA(),c.TgZ(5,"p",20),c._uU(6),c.qZA(),c.TgZ(7,"p",20),c._uU(8),c.qZA(),c.TgZ(9,"p",20),c._uU(10),c.qZA(),c.qZA(),c.YNc(11,jy,17,5,"div",21),c.qZA()),2&n){const t=e.ngIf;c.xp6(1),c.Q6J("src",t.imageUrl,c.LSH),c.xp6(3),c.Oqu(t.title),c.xp6(2),c.hij("Artist: ",t.artist,""),c.xp6(2),c.Oqu(t.artistBio),c.xp6(2),c.hij("Credits From ",t.credits,""),c.xp6(1),c.Q6J("ngIf",t)}}let Ky=(()=>{class n{constructor(t,r,s,i){this.facade=t,this.formBuilder=r,this.auth=s,this.eventBus=i,this.unsubscribe$=new Ha.x,this.form=new pe.cw({}),this.searchKey="",this.searchHasError=!1,this.selectArt$=null,this.submitted=!1}get lastThreeSearches(){return this.facade.lastThreeSearches}get ratings(){return Ed}search(){this.searchKey?(this.searchHasError=!1,this.facade.addToLastSearches(this.searchKey),this.fetchArt(this.searchKey)):this.searchHasError=!0}fetchArt(t){this.selectArt$=this.facade.fetchArt(t)}buildForm(){this.form=this.formBuilder.group({review:["",[pe.kI.required,pe.kI.minLength(10)]],rating:1})}submit(t){if(this.submitted=!0,this.form.invalid)return;const r=this.form.value;this.facade.submit({objectIds:t.objectID,uid:this.auth.userId,rating:r.rating,review:r.review})}formReset(){var t,r;this.form.reset(),this.form.updateValueAndValidity(),this.submitted=!1,null===(t=this.form.get("review"))||void 0===t||t.setValue(""),null===(r=this.form.get("rating"))||void 0===r||r.setValue(1)}ngOnInit(){this.buildForm(),this.facade.restoreState(),this.eventBus.on(Wa).pipe(function(n){return(0,qs.e)((e,t)=>{(0,_d.Xf)(n).subscribe(new Us.Q(t,()=>t.complete(),Td.Z)),!t.closed&&e.subscribe(t)})}(this.unsubscribe$)).subscribe(()=>this.formReset())}}return n.\u0275fac=function(t){return new(t||n)(c.Y36(Ga),c.Y36(pe.qu),c.Y36(pd.e),c.Y36(yd))},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-add"]],features:[c._Bn([Ga,Ja])],decls:21,vars:15,consts:[[1,"py-3","text-center","middle"],[1,"col-lg-6","col-md-8","mx-auto"],[1,"fw-light","text-white","title1"],[1,"py-5"],[1,"container","d-flex","justify-content-center","flex-column","w-100"],[1,"row","d-flex","justify-content","-center","section2"],[1,"search-form","d-flex","justify-content-center","flex-column","search2"],["type","text",1,"form-control",3,"ngModel","placeholder","ngModelChange"],[1,"btn","btn-danger","mt-2","search",3,"click"],["class","alert alert-danger mt-2","role","alert",4,"ngIf"],[1,"row","d-flex","justify-content-center","mt-2","flex-row","mb-3"],[1,"d-flex","justify-content-center"],["class","badge badge-pill badge-danger",3,"click",4,"ngFor","ngForOf"],["class","mb-3 content","style","max-width: 18rem",4,"ngIf"],["role","alert",1,"alert","alert-danger","mt-2"],[1,"badge","badge-pill","badge-danger",3,"click"],[1,"mb-3","content",2,"max-width","18rem"],["alt","Card image cap",1,"card-img-top","image",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-t1"],["class","row form",4,"ngIf"],[1,"row","form"],[3,"formGroup","submit"],[1,"row","mb-3"],["for","review",1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["formControlName","review","id","review","cols","form-control"],["appCharacter","",3,"length"],["for","rating",1,"col-sm-2","col-form-label"],["class","ms-2",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-danger"],[4,"ngIf"],[1,"ms-2"],["type","radio","formControlName","rating",1,"form-check-input",3,"value"]],template:function(t,r){1&t&&(c.TgZ(0,"main"),c.TgZ(1,"section",0),c.TgZ(2,"div",1),c.TgZ(3,"h1",2),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(6,"div",3),c.TgZ(7,"div",4),c.TgZ(8,"div",5),c.TgZ(9,"div",6),c.TgZ(10,"input",7),c.NdJ("ngModelChange",function(i){return r.searchKey=i}),c.ALo(11,"translate"),c.qZA(),c.TgZ(12,"button",8),c.NdJ("click",function(){return r.search()}),c._uU(13),c.ALo(14,"translate"),c.qZA(),c.YNc(15,My,3,3,"div",9),c.qZA(),c.qZA(),c.TgZ(16,"div",10),c.TgZ(17,"div",11),c.YNc(18,Py,2,1,"span",12),c.qZA(),c.qZA(),c.qZA(),c.YNc(19,Zy,12,6,"div",13),c.ALo(20,"async"),c.qZA(),c.qZA()),2&t&&(c.xp6(4),c.hij(" ",c.lcZ(5,7,"catalogue.ADD_ART")," "),c.xp6(6),c.s9C("placeholder",c.lcZ(11,9,"catalogue.ENTER_ART_NAME")),c.Q6J("ngModel",r.searchKey),c.xp6(3),c.hij(" ",c.lcZ(14,11,"catalogue.SEARCH")," "),c.xp6(2),c.Q6J("ngIf",r.searchHasError),c.xp6(3),c.Q6J("ngForOf",r.lastThreeSearches),c.xp6(1),c.Q6J("ngIf",c.lcZ(20,13,r.selectArt$)))},directives:[pe.Fj,pe.JJ,pe.On,Pe.O5,Pe.sg,pe._Y,pe.JL,pe.sg,pe.u,Fy,pe._],pipes:[vd.X$,Pe.Ov],styles:["main[_ngcontent-%COMP%]{background-image:url(home_anibal.ba5f1db9b0816c3d.jpg);background-size:cover;width:100%;height:100vh}.search-form[_ngcontent-%COMP%]{max-width:800px}.search[_ngcontent-%COMP%]{max-width:500px}.search2[_ngcontent-%COMP%]{box-sizing:content-box}.alert[_ngcontent-%COMP%]{margin-bottom:0!important}.badge[_ngcontent-%COMP%]{cursor:pointer}.title1[_ngcontent-%COMP%]{position:fixed;top:30%;left:50%;margin-top:-100px;margin-left:-100px}.section2[_ngcontent-%COMP%]{position:fixed;top:40%;left:50%;margin-top:-100px;margin-left:-100px}.image[_ngcontent-%COMP%]{max-width:400px;max-height:400px;background-color:none}.content[_ngcontent-%COMP%]{position:fixed;top:45%;left:20%;display:flex}.card-body[_ngcontent-%COMP%]{color:#fff;font-weight:600;background:#000000;opacity:.6}.card-t1[_ngcontent-%COMP%]{font-weight:300;width:max-content}.badge[_ngcontent-%COMP%]{background-color:#dc3545;top:40%;margin-right:5px;margin-top:170px}.form[_ngcontent-%COMP%]{color:#fff;position:fixed;display:fixed;top:70%;left:45%;width:-moz-fit-content;width:fit-content}"]}),n})();var $y=D(8100);function Gy(n,e){if(1&n){const t=c.EpF();c.TgZ(0,"div",1),c.TgZ(1,"div",2),c._UZ(2,"img",3),c.qZA(),c.TgZ(3,"div",4),c.TgZ(4,"div",5),c.TgZ(5,"p",6),c._uU(6),c.qZA(),c.TgZ(7,"div",7),c.TgZ(8,"button",8),c.NdJ("click",function(){return c.CHM(t),c.oxw().goToDetails()}),c._uU(9," Details "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&n){const t=c.oxw();c.xp6(2),c.Q6J("src",null==t.item.art?null:t.item.art.primaryImageSmall,c.LSH),c.xp6(4),c.Oqu(null==t.item.art?null:t.item.art.title)}}let zy=(()=>{class n{constructor(t){this.router=t}goToDetails(){var t;this.router.navigate([`content/${null===(t=this.item)||void 0===t?void 0:t.data.id}`])}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(c.Y36(Bt.F0))},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-art-list-item"]],inputs:{item:"item"},decls:1,vars:1,consts:[["class","col",4,"ngIf"],[1,"col"],[1,"image"],[1,"image","card-img-top","image",3,"src"],[1,"card","shadow-sm"],[1,"card-body"],[1,"h4"],[1,"btn-group"],["type","button",1,"btn","btn-outline-light","btn-sm",3,"click"]],template:function(t,r){1&t&&c.YNc(0,Gy,10,2,"div",0),2&t&&c.Q6J("ngIf",r.item)},directives:[Pe.O5],styles:[".image[_ngcontent-%COMP%]{max-width:300px;max-height:300px}.col[_ngcontent-%COMP%]{position:fixed;top:40%}.card[_ngcontent-%COMP%]{width:max-content;color:#fff;font-weight:600;background:none}.card-body[_ngcontent-%COMP%]{background:none;padding:0;text-align:center;width:300px}"],changeDetection:0}),n})();function Qy(n,e){if(1&n&&(c.ynx(0),c._UZ(1,"app-art-list-item",4),c.BQk()),2&n){const t=e.$implicit;c.xp6(1),c.Q6J("item",t)}}let wd=(()=>{class n{constructor(t,r,s){this.fireApiService=t,this.museumApiService=r,this.loadingService=s}mapArtData(t){return t.map(r=>this.museumApiService.getArtByObjectId(r.objectIds).pipe((0,ye.U)(s=>({data:r,art:s}))))}ngOnInit(){this.loadingService.start(),this.art$=this.fireApiService.getArts().pipe((0,Ya.w)(t=>(0,$y.D)(this.mapArtData(t))),(0,Vs.x)(()=>this.loadingService.stop()))}}return n.\u0275fac=function(t){return new(t||n)(c.Y36($a),c.Y36(xr),c.Y36(js.j))},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-list"]],decls:5,vars:3,consts:[[1,"album","py-5","bf-light"],[1,"container"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[4,"ngFor","ngForOf"],[3,"item"]],template:function(t,r){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.YNc(3,Qy,2,1,"ng-container",3),c.ALo(4,"async"),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(3),c.Q6J("ngForOf",c.lcZ(4,1,r.art$)))},directives:[Pe.sg,zy],pipes:[Pe.Ov],styles:[""]}),n})(),Hy=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-content"]],decls:12,vars:0,consts:[[1,"main1"],[1,"py-5","text-center","middle"],[1,"col-lg-6","col-md","8","mx-auto","title1"],[1,"fw-ligh","text-white"],[1,"lead","text-white"],["routerLink","add",1,"btn","btn-outline-light"]],template:function(t,r){1&t&&(c.TgZ(0,"main",0),c.TgZ(1,"section",1),c.TgZ(2,"div",2),c.TgZ(3,"h1",3),c._uU(4,"EXPLORE THE COLLECTION"),c.qZA(),c.TgZ(5,"p",4),c._uU(6," You Can Add Your Favourite Art Work "),c.qZA(),c.TgZ(7,"p"),c.TgZ(8,"a",5),c._uU(9,"Add Art Work"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(10,"section"),c._UZ(11,"app-list"),c.qZA(),c.qZA())},directives:[Bt.yS,wd],styles:[".main1[_ngcontent-%COMP%]{background-image:url(modern.b52cc3b1a6e4904e.jpg);background-size:cover;width:100%;height:100vh}.title1[_ngcontent-%COMP%]{padding-top:40px}.middle[_ngcontent-%COMP%]{padding-top:0}"]}),n})();var Wy=D(7384);function Yy(n,e){if(1&n&&(c.ynx(0),c.TgZ(1,"div"),c._UZ(2,"img",5),c.qZA(),c.BQk()),2&n){const t=e.ngIf;c.xp6(2),c.Q6J("src",t.primaryImageSmall,c.LSH)}}function Jy(n,e){if(1&n&&(c.ynx(0),c.TgZ(1,"h3"),c._uU(2),c.qZA(),c.TgZ(3,"p"),c._uU(4),c.qZA(),c.TgZ(5,"p"),c._uU(6),c.qZA(),c.TgZ(7,"p"),c._uU(8),c.qZA(),c.TgZ(9,"p"),c._uU(10),c.qZA(),c.BQk()),2&n){const t=e.ngIf;c.xp6(2),c.Oqu(t.title),c.xp6(2),c.Oqu(t.accessionYear),c.xp6(2),c.Oqu(t.artistAlphaSort),c.xp6(2),c.Oqu(t.artistDisplayBio),c.xp6(2),c.hij("Credits from ",t.creditLine,"")}}function Xy(n,e){if(1&n&&(c.ynx(0),c.TgZ(1,"p"),c._uU(2),c.qZA(),c.TgZ(3,"p"),c._uU(4),c.qZA(),c.BQk()),2&n){const t=e.ngIf;c.xp6(2),c.Oqu(t.review),c.xp6(2),c.hij("Raiting: ",t.rating,"/5")}}const ev=[{path:"",component:Hy},{path:"list",component:wd},{path:"add",component:Ky},{path:":id",component:(()=>{class n{constructor(t,r,s,i,o){this.activatedRoute=t,this.fireApiService=r,this.museumApiService=s,this.router=i,this.loadingService=o}initArtDetails(){const t=this.activatedRoute.snapshot.params.id;this.loadingService.start(),this.storeData$=this.fireApiService.getArt(t).pipe((0,Wy.b)(r=>{r&&(this.artData$=this.museumApiService.getArtByObjectId(r.objectIds).pipe((0,Vs.x)(()=>this.loadingService.stop())))}))}goBack(){this.router.navigate(["content"])}ngOnInit(){this.initArtDetails()}}return n.\u0275fac=function(t){return new(t||n)(c.Y36(Bt.gz),c.Y36($a),c.Y36(xr),c.Y36(Bt.F0),c.Y36(js.j))},n.\u0275cmp=c.Xpm({type:n,selectors:[["app-details"]],decls:11,vars:9,consts:[[1,"main1"],[1,"box"],[4,"ngIf"],[1,"container"],[1,"btn","btn-outline-danger",3,"click"],[1,"img",3,"src"]],template:function(t,r){1&t&&(c.TgZ(0,"main",0),c.TgZ(1,"div",1),c.YNc(2,Yy,3,1,"ng-container",2),c.ALo(3,"async"),c.TgZ(4,"div",3),c.YNc(5,Jy,11,5,"ng-container",2),c.ALo(6,"async"),c.YNc(7,Xy,5,2,"ng-container",2),c.ALo(8,"async"),c.TgZ(9,"button",4),c.NdJ("click",function(){return r.goBack()}),c._uU(10,"Go Back"),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(2),c.Q6J("ngIf",c.lcZ(3,3,r.artData$)),c.xp6(3),c.Q6J("ngIf",c.lcZ(6,5,r.artData$)),c.xp6(2),c.Q6J("ngIf",c.lcZ(8,7,r.storeData$)))},directives:[Pe.O5],pipes:[Pe.Ov],styles:[".main1[_ngcontent-%COMP%]{background-image:url(met.29f0c70652c8c44f.jpg);background-size:cover;width:100%;height:100vh}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:#dc3545;font-weight:bold;background:white;opacity:.7}.img[_ngcontent-%COMP%]{max-width:500px;max-height:500px}.box[_ngcontent-%COMP%]{position:fixed;margin-top:-100px;margin-left:-100px;top:30%;left:30%;display:flex}"]}),n})()}];let tv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({imports:[[Bt.Bz.forChild(ev)],Bt.Bz]}),n})();var nv=D(1382);let rv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[xr,Ga],imports:[[Pe.ez,pe.u5,pe.UX,tv,nv.m,pe.u5,vd.aw]]}),n})()}}]);